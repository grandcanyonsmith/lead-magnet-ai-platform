{
  "research_instructions": "Parse and validate form fields. Required fields: [hospital_name], [hospital_city], [hospital_state], [due_date]. Optional fields: [patient_city], [patient_state], [patient_zip], [country], [search_radius_miles], [birth_preferences], [partner_name], [support_people], [language], [insurance_current], [insurance_state], [household_income], [family_size], [employer_insurance_available], [preferred_doctor_or_midwife], [preferred_birth_style], [cesarean_history], [twins_or_multiples], [risk_factors], [email], [phone]. Compute: gestational_week, days_to_due_date, trimester, season_at_due_date (by hemisphere). Set defaults: [search_radius_miles]=25 if missing; [country]=USA if missing. Output a clean JSON context block that later steps can consume.",
  "workflow_description": "A personalized 12-page birth plan and hospital bag guide that auto-fills with your hospital’s maps, parking, staff, floor layout, policies, tailored packing lists by season, insurance picks, and curated local crib deals plus Hermes babywear.",
  "workflow_name": "Baby-Day Blueprint",
  "steps": [
    {
      "step_description": "Normalize inputs, compute key dates, and set safe defaults.",
      "instructions": "Parse and validate form fields. Required fields: [hospital_name], [hospital_city], [hospital_state], [due_date]. Optional fields: [patient_city], [patient_state], [patient_zip], [country], [search_radius_miles], [birth_preferences], [partner_name], [support_people], [language], [insurance_current], [insurance_state], [household_income], [family_size], [employer_insurance_available], [preferred_doctor_or_midwife], [preferred_birth_style], [cesarean_history], [twins_or_multiples], [risk_factors], [email], [phone]. Compute: gestational_week, days_to_due_date, trimester, season_at_due_date (by hemisphere). Set defaults: [search_radius_miles]=25 if missing; [country]=USA if missing. Output a clean JSON context block that later steps can consume.",
      "step_order": 0,
      "step_name": "Intake & Validation",
      "tool_choice": "none",
      "model": "gpt-5",
      "tools": []
    },
    {
      "step_description": "Gather hospital-specific details: address, L&D unit info, parking, floor layout, policies, contacts.",
      "instructions": "Using [hospital_name], [hospital_city], [hospital_state], research official and reputable sources. Collect: full address, main phone, L&D triage phone (if public), admissions/check-in process, visitor policy, L&D unit location, NICU availability/level, anesthesia/OR availability, typical postpartum room type, baby-friendly designation status, on-site amenities, breastfeeding/lactation support, and any pre-registration links. Find parking locations with names, addresses, costs, hours, accessible parking and the best entrance for L&D arrivals. If available publicly, capture simplified floor layout for L&D/postpartum (e.g., what floor, nearby elevators, nurse station); do not include non-public or sensitive security details. Provide a Google Maps and OpenStreetMap link for the hospital and parking, plus coordinates. Include staff directory page URLs (public only; no scraping of private contact details). Summarize tips specific to the hospital (e.g., check-in entrance after hours, where wheelchairs are, cafeteria hours). Return a structured JSON with fields: hospital_profile, parking, entrances, wayfinding_notes, policies, amenities, sources (array of {title, url}).",
      "step_order": 1,
      "step_name": "Hospital & Logistics Research",
      "tool_choice": "required",
      "model": "o3-deep-research",
      "tools": [
        "web_search_preview"
      ]
    },
    {
      "step_description": "Identify top insurance options accepted by the selected hospital.",
      "instructions": "Using [insurance_state], [household_income], [family_size], [employer_insurance_available], [insurance_current], [due_date], and the hospital acceptance list from the prior step, find 2–4 strong insurance options that are likely the best fit. Prioritize: plans in-network with the hospital and [preferred_doctor_or_midwife], low total cost of care for maternity (premium + out-of-pocket), strong maternity benefits, and newborn coverage. Use authoritative sources: Healthcare.gov or state exchange, insurer sites, and the hospital's accepted plans page. Provide plan name, metal tier, monthly premium estimate for the family size, deductible, out-of-pocket max, network type (HMO/PPO/EPO), in-network confirmation with source link, maternity coverage highlights, and enrollment deadlines. Clarify if COBRA or Medicaid/CHIP may apply. Include a brief non-advisory disclaimer. Return JSON: insurance_recommendations (array), methodology, sources.",
      "step_order": 2,
      "step_name": "Insurance Fit Analysis",
      "tool_choice": "required",
      "model": "o3-deep-research",
      "tools": [
        "web_search_preview"
      ]
    },
    {
      "step_description": "Curate nearby crib listings with image URLs.",
      "instructions": "Search for cribs near [patient_city], [patient_state], [patient_zip] within [search_radius_miles] miles. Target public listings first on Facebook Marketplace (only publicly viewable pages), then reputable alternatives (Craigslist, OfferUp, Nextdoor public listings, local baby consignment stores). Extract: title, price, condition, city, approximate distance, primary image_url, listing_url, posted_date (if visible), seller notes (brief), and safety notes (e.g., ensure JPMA certification; avoid drop-side cribs). Provide at least 6 items if available. Do not bypass paywalls or logins. Return JSON: local_crib_listings (array) and sources.",
      "step_order": 3,
      "step_name": "Local Marketplace Crib Finder",
      "tool_choice": "required",
      "model": "o3-deep-research",
      "tools": [
        "web_search_preview"
      ]
    },
    {
      "step_description": "Select Hermes baby clothing and accessories with images and links.",
      "instructions": "Source Hermes baby items (onesies, blankets, hats, booties, bibs) from Hermes.com and authorized retailers. For each, provide: product_name, category, price, currency, product_url, image_url, available_sizes, colorway, and notable materials. Prefer official product imagery. Return JSON: hermes_baby_catalog (array) and sources.",
      "step_order": 4,
      "step_name": "Hermes Babywear Curator",
      "tool_choice": "required",
      "model": "o3-deep-research",
      "tools": [
        "web_search_preview"
      ]
    },
    {
      "step_description": "Tailor hospital bag lists to due date season and local climate.",
      "instructions": "Use [patient_city], [patient_state or country], and [due_date]. Research typical weather and temperature ranges for the due month using reputable climate sources (e.g., NOAA, Met.no, Meteoblue, national meteorological office). With code, compute gestational timeline milestones and packing adjustments for seasonality (heat/cold), potential snow/heatwave contingencies, and regional needs. Output granular, deduplicated packing lists: birthing person, partner/support, baby, documents & insurance, comfort, tech & chargers, toiletries, snacks & hydration, postpartum care, lactation, c-section extras (if [cesarean_history]=true or as contingency), NICU go-bag contingency. Note hospital-provided items from prior step to avoid overpacking. Return JSON: packing_lists (object), climate_summary, assumptions, sources.",
      "step_order": 5,
      "step_name": "Weather & Seasonal Packing",
      "tool_choice": "auto",
      "model": "gpt-5",
      "tools": [
        "web_search_preview",
        "code_interpreter"
      ]
    },
    {
      "step_description": "Create annotated map(s) for hospital arrival, parking, and L&D location.",
      "instructions": "Using coordinates and entrance/parking info from Hospital & Logistics Research, generate at least two images: (1) Campus Arrival Map with pins for Main Entrance, L&D Entrance, Emergency, Parking Garages/Lots (label names), accessible routes; (2) L&D Wayfinding Schematic showing elevators, triage, nurse station, OR, postpartum rooms, NICU (if available), and check-in desk. Include clear labels, high-contrast colors, and print-friendly style. If floor-level details are not publicly available, create a generic but helpful schematic and note that it is approximate. Output image assets with captions and alt text. Return JSON: map_images (array of {title, alt, image_url or data_uri, caption}).",
      "step_order": 6,
      "step_name": "Custom Map & Wayfinding Visuals",
      "tool_choice": "auto",
      "model": "gpt-5",
      "tools": [
        "image_generation"
      ]
    },
    {
      "step_description": "Compose a concise, hospital-aware birth plan.",
      "instructions": "Based on [birth_preferences], [preferred_birth_style], [support_people], and the hospital policies from research, draft a one- to two-page birth plan with sections: Support Team & Communication; Environment & Mobility; Monitoring; Pain Management; Interventions & Consent; Pushing & Positions; Cesarean Preferences; Immediate Newborn Care (delayed cord clamping, skin-to-skin, vitamin K/eye ointment, Hep B, rooming-in); Feeding & Lactation; Cultural/Religious Considerations; Special Notes & Allergies. Flag any hospital policy conflicts neutrally and suggest alternatives. Keep language clear, respectful, and concise. Return JSON: birth_plan {sections...}.",
      "step_order": 7,
      "step_name": "Birth Plan Draft",
      "tool_choice": "none",
      "model": "gpt-5",
      "tools": []
    },
    {
      "step_description": "Assemble the 12-page guide as styled, print-ready HTML.",
      "instructions": "Combine outputs from prior steps into a cohesive, 12-page-equivalent HTML document with inline CSS optimized for print (Letter/A4). Structure: 1) Cover (title, names, hospital, due date); 2) Table of Contents; 3) Hospital Quick Facts; 4) Parking & Arrivals; 5) Floor Layout & Wayfinding (with images from map_images); 6) Check-in & Policies; 7) Personalized Packing Lists; 8) Birth Plan; 9) Insurance Recommendations; 10) Local Crib Deals (with images/links); 11) Hermes Babywear Picks (with images/links); 12) Emergency & Resources (L&D, NICU, lactation contacts). Include accessible markup (headings, alt text), page-break CSS between major sections, and clickable links. Cite sources in a References section at the end with titles and URLs. Ensure valid, complete HTML.",
      "step_order": 8,
      "step_name": "HTML Rewrite",
      "tool_choice": "none",
      "model": "gpt-5",
      "tools": []
    },
    {
      "step_description": "Validate HTML, fix accessibility issues, and summarize fixes.",
      "instructions": "Programmatically validate the generated HTML: check for missing alt text, color contrast, heading hierarchy, link text clarity, and print pagination consistency. Apply non-destructive fixes and output a brief QA report summarizing issues found and resolved. Return the corrected final HTML.",
      "step_order": 9,
      "step_name": "Accessibility & QA",
      "tool_choice": "auto",
      "model": "gpt-5",
      "tools": [
        "code_interpreter"
      ]
    },
    {
      "step_description": "Convert final HTML into a paginated PDF with headers/footers.",
      "instructions": "Render the final HTML to a multi-page PDF suitable for printing. Add header/footer: left=Baby-Day Blueprint, center=[hospital_name], right=Page X of Y. Preserve images at print-friendly resolution and ensure page breaks align with sections. Output the PDF as a downloadable file along with the final HTML, returning file names/paths or links as supported.",
      "step_order": 10,
      "step_name": "Export to PDF",
      "tool_choice": "auto",
      "model": "gpt-5",
      "tools": [
        "code_interpreter"
      ]
    }
  ]
}