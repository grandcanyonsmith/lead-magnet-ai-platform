(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7873],{98771:function(e,t,r){Promise.resolve().then(r.bind(r,97119))},75841:function(e,t,r){"use strict";r.d(t,{Z:function(){return m}});var s=r(37821),a=r(77851),l=r(69526),o=r(16058),n=r(96490),i=r(91309),d=r(12700),c=r(97917);function m(e){let{step:t,index:r,totalSteps:m,allSteps:u=[],onChange:p,onDelete:h,onMoveUp:x,onMoveDown:g,workflowId:f}=e,{localStep:b,webhookHeaders:w,handleChange:_,handleWebhookHeadersChange:y}=(0,d.x)({step:t,index:r,onChange:p}),{computerUseConfig:v,isToolSelected:j,handleToolToggle:k,handleComputerUseConfigChange:N}=(0,c.t)({step:b,onChange:_});return(0,s.jsxs)("div",{className:"border border-gray-300 rounded-lg p-6 bg-white shadow-sm",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),e.stopPropagation())},children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex items-center gap-1 text-gray-400",children:(0,s.jsx)("span",{className:"text-xs",children:"⋮⋮"})}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Step ",r+1]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>x(r),disabled:0===r,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step up",children:(0,s.jsx)(a.rH8,{className:"w-5 h-5"})}),(0,s.jsx)("button",{type:"button",onClick:()=>g(r),disabled:r===m-1,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step down",children:(0,s.jsx)(a.bTu,{className:"w-5 h-5"})}),(0,s.jsx)("button",{type:"button",onClick:()=>h(r),className:"p-2 text-red-600 hover:text-red-700 touch-target","aria-label":"Delete step",children:(0,s.jsx)(a.Ybf,{className:"w-5 h-5"})})]})]}),(0,s.jsx)(i.E,{workflowId:f,step:b,stepIndex:r,onAccept:e=>{p(r,e)}}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l.b,{step:b,onChange:_}),("ai_generation"===b.step_type||!b.step_type)&&(0,s.jsx)(o.b,{step:b,isToolSelected:j,onToolToggle:k,onToolChoiceChange:e=>_("tool_choice",e),onComputerUseConfigChange:N,computerUseConfig:v}),(()=>{let e="webhook"===b.step_type;return console.log("[WorkflowStepEditor] Rendering step",r,"step_type:",b.step_type,"isWebhook:",e),e&&(0,s.jsx)(n.E,{step:b,webhookHeaders:w,allSteps:u,currentStepIndex:r,onChange:_,onWebhookHeadersChange:y})})(),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dependencies (optional)"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Select which steps must complete before this step runs. Leave empty to auto-detect from step order."}),(0,s.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3",children:u.length>0?u.map((e,t)=>{if(t===r)return null;let a=(b.depends_on||[]).includes(t);return(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:a,onChange:e=>{let r=b.depends_on||[];_("depends_on",e.target.checked?[...r,t]:r.filter(e=>e!==t))},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,s.jsxs)("span",{className:"text-sm text-gray-900",children:["Step ",t+1,": ",e.step_name]})]},t)}):(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No other steps available"})}),b.depends_on&&b.depends_on.length>0&&(0,s.jsxs)("p",{className:"mt-2 text-xs text-gray-600",children:["Depends on: ",b.depends_on.map(e=>"Step ".concat(e+1)).join(", ")]})]})]})]})}},97119:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var s=r(37821),a=r(58078),l=r(58504),o=r(77851),n=r(75841);function i(e){let{formData:t,onChange:r}=e;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Lead Magnet Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Lead Magnet Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:t.workflow_name,onChange:e=>r("workflow_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Course Idea Validator",maxLength:200,required:!0,"data-tour":"workflow-name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{value:t.workflow_description,onChange:e=>r("workflow_description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Describe what this lead magnet does...",rows:3,maxLength:1e3,"data-tour":"workflow-description"})]})]})}function d(e){let{templateData:t,onChange:r}=e,[l,n]=(0,a.useState)(!1),i=(0,a.useMemo)(()=>{if(!t.html_content.trim())return"";let e=t.html_content,r={TITLE:"Sample Lead Magnet Title",CONTENT:"This is sample content that will be replaced with your actual lead magnet content when the template is used.",AUTHOR_NAME:"John Doe",COMPANY_NAME:"Your Company",DATE:new Date().toLocaleDateString(),EMAIL:"user@example.com",PHONE:"+1 (555) 123-4567",CURRENT_YEAR:new Date().getFullYear().toString()};return Object.keys(r).forEach(t=>{let s=RegExp("\\{\\{".concat(t,"\\}\\}"),"g");e=e.replace(s,r[t])}),e=e.replace(/\{\{([A-Z_]+)\}\}/g,"[$1]")},[t.html_content]);return(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Template Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Template Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:t.template_name,onChange:e=>r("template_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Email Template",maxLength:200,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{value:t.template_description,onChange:e=>r("template_description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Describe what this template is used for...",rows:3,maxLength:1e3})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["HTML Content ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),t.html_content.trim()&&(0,s.jsxs)("div",{className:"mb-4 border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[(0,s.jsx)(o.rDJ,{className:"w-4 h-4 mr-2"}),"HTML Preview"]}),(0,s.jsx)("button",{type:"button",onClick:()=>n(!l),className:"text-sm text-gray-600 hover:text-gray-900",children:l?"Hide Preview":"Show Preview"})]}),l&&(0,s.jsx)("div",{className:"bg-white border-t border-gray-200",style:{height:"600px"},children:(0,s.jsx)("iframe",{srcDoc:i,className:"w-full h-full border-0",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"},"preview-".concat(t.html_content.length,"-").concat(t.html_content.slice(0,50)))})]}),(0,s.jsx)("textarea",{value:t.html_content,onChange:e=>{r("html_content",e.target.value),e.target.value.trim()&&!l&&n(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono text-sm",placeholder:"<!DOCTYPE html>...",rows:20,required:!0}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Use ",(0,s.jsx)("code",{className:"px-1 py-0.5 bg-gray-100 rounded",children:"{{PLACEHOLDER_NAME}}"})," syntax for dynamic content."]}),t.placeholder_tags.length>0&&(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Detected placeholders:"}),t.placeholder_tags.map(e=>(0,s.jsx)("span",{className:"px-2 py-1 bg-primary-50 text-primary-700 rounded text-xs font-mono",children:"{{".concat(e,"}}")},e))]})]})]})}function c(e){let{formFieldsData:t,onChange:r,onFieldChange:l}=e,[n,i]=(0,a.useState)(!1);return 0===t.form_fields_schema.fields.length?null:(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Lead Capture Form"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Form Name ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:t.form_name,onChange:e=>{r("form_name",e.target.value),e.target.value.trim()&&!n&&i(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Lead Capture Form",maxLength:200,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Public Slug ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:t.public_slug,onChange:e=>r("public_slug",e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono",placeholder:"lead-capture-form",pattern:"[a-z0-9\\-]+",required:!0}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["URL-friendly identifier (lowercase, hyphens only). Forms will be accessible at /v1/forms/",t.public_slug||"[slug]"]})]}),t.form_fields_schema.fields.length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[(0,s.jsx)(o.rDJ,{className:"w-4 h-4 mr-2"}),"Form Preview"]}),(0,s.jsx)("button",{type:"button",onClick:()=>i(!n),className:"text-sm text-gray-600 hover:text-gray-900",children:n?"Hide Preview":"Show Preview"})]}),n&&(0,s.jsxs)("div",{className:"bg-white p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:t.form_name||"Form Preview"}),(0,s.jsxs)("div",{className:"space-y-4",children:[t.form_fields_schema.fields.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.label||"Field ".concat(t+1),e.required&&(0,s.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),"textarea"===e.field_type?(0,s.jsx)("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:e.placeholder||"",rows:4,disabled:!0}):"select"===e.field_type&&e.options?(0,s.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:!0,children:[(0,s.jsxs)("option",{value:"",children:["Select ",e.label]}),e.options.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]}):(0,s.jsx)("input",{type:"email"===e.field_type?"email":"tel"===e.field_type?"tel":"number"===e.field_type?"number":"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:e.placeholder||"",disabled:!0})]},e.field_id||t)),(0,s.jsx)("button",{type:"button",className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:!0,children:"Submit"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Form Fields (",t.form_fields_schema.fields.length,")"]}),(0,s.jsx)("div",{className:"space-y-4",children:t.form_fields_schema.fields.map((e,t)=>{var r;return(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Label"}),(0,s.jsx)("input",{type:"text",value:e.label||"",onChange:e=>l(t,"label",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Field Label"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Type"}),(0,s.jsxs)("select",{value:e.field_type||"text",onChange:e=>l(t,"field_type",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,s.jsx)("option",{value:"text",children:"Text"}),(0,s.jsx)("option",{value:"email",children:"Email"}),(0,s.jsx)("option",{value:"tel",children:"Phone"}),(0,s.jsx)("option",{value:"textarea",children:"Textarea"}),(0,s.jsx)("option",{value:"select",children:"Select"}),(0,s.jsx)("option",{value:"number",children:"Number"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Placeholder"}),(0,s.jsx)("input",{type:"text",value:e.placeholder||"",onChange:e=>l(t,"placeholder",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Placeholder text"})]}),(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.required||!1,onChange:e=>l(t,"required",e.target.checked),className:"mr-2"}),(0,s.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"Required"})]})})]}),"select"===e.field_type&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Options (comma-separated)"}),(0,s.jsx)("input",{type:"text",value:(null===(r=e.options)||void 0===r?void 0:r.join(", "))||"",onChange:e=>l(t,"options",e.target.value.split(",").map(e=>e.trim()).filter(Boolean)),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Option 1, Option 2, Option 3"})]})]},e.field_id||t)})})]})]})}function m(e){let{formData:t,onChange:r}=e;return(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Delivery Configuration"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Configure how completed lead magnets are delivered to leads. Choose webhook or SMS delivery."}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Method"}),(0,s.jsxs)("select",{value:t.delivery_method,onChange:e=>r("delivery_method",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,s.jsx)("option",{value:"none",children:"No Delivery (Manual)"}),(0,s.jsx)("option",{value:"webhook",children:"Webhook"}),(0,s.jsx)("option",{value:"sms",children:"SMS (Twilio)"})]}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Select how you want to deliver the completed lead magnet to the lead"})]}),"webhook"===t.delivery_method&&(0,s.jsxs)("div",{className:"space-y-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"Webhook Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Webhook URL ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"url",value:t.delivery_webhook_url,onChange:e=>r("delivery_webhook_url",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://api.example.com/webhook",required:"webhook"===t.delivery_method}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"The webhook will receive a POST request with job details, submission data, and output URL"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Headers (Optional)"}),(0,s.jsx)("textarea",{value:JSON.stringify(t.delivery_webhook_headers,null,2),onChange:e=>{try{let t=JSON.parse(e.target.value);r("delivery_webhook_headers",t)}catch(e){}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono text-sm",placeholder:'{\\n  "Authorization": "Bearer token",\\n  "X-Custom-Header": "value"\\n}',rows:4}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"JSON object with custom headers to include in webhook requests"})]})]}),"sms"===t.delivery_method&&(0,s.jsxs)("div",{className:"space-y-4 bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-900",children:"SMS Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center mb-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.delivery_sms_ai_generated,onChange:e=>r("delivery_sms_ai_generated",e.target.checked),className:"mr-2"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Use AI-Generated SMS Message"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 ml-6",children:"AI will generate a personalized SMS message based on the lead magnet content"})]}),t.delivery_sms_ai_generated?(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI SMS Instructions (Optional)"}),(0,s.jsx)("textarea",{value:t.delivery_sms_ai_instructions,onChange:e=>r("delivery_sms_ai_instructions",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Example: Keep it friendly and under 160 characters. Include the lead's name and make it personal.",rows:3}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Optional instructions for AI SMS generation. If empty, defaults to friendly message with URL."})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Message Template"}),(0,s.jsx)("textarea",{value:t.delivery_sms_message,onChange:e=>r("delivery_sms_message",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Hi {name}! Your personalized report is ready: {output_url}",rows:3,maxLength:320}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Use placeholders: ","{name}",", ","{output_url}",", ","{job_id}",". Max 160 characters per SMS."]})]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:(0,s.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,s.jsx)("strong",{children:"Note:"})," Twilio credentials must be configured in AWS Secrets Manager (us-east-1) for SMS delivery to work."]})})]})]})}var u=r(63951);let p={workflow_name:"",workflow_description:"",template_id:"",template_version:0,delivery_method:"none",delivery_webhook_url:"",delivery_webhook_headers:{},delivery_sms_enabled:!1,delivery_sms_message:"",delivery_sms_ai_generated:!1,delivery_sms_ai_instructions:""},h={template_name:"",template_description:"",html_content:"",placeholder_tags:[]},x={form_name:"",public_slug:"",form_fields_schema:{fields:[]}},g=[{step_name:"Deep Research",step_description:"Generate comprehensive research report",model:"gpt-5",instructions:"",step_order:0,tools:["web_search_preview"],tool_choice:"auto"},{step_name:"HTML Rewrite",step_description:"Rewrite content into styled HTML matching template",model:"gpt-5",instructions:"Rewrite the research content into styled HTML matching the provided template. Ensure the output is complete, valid HTML that matches the template's design and structure.",step_order:1,tools:[],tool_choice:"none"}];function f(){var e,t,r;let f=(0,l.useRouter)(),[b,w]=(0,a.useState)("prompt"),[_,y]=(0,a.useState)(""),[v,j]=(0,a.useState)(null),[k,N]=(0,a.useState)(null),[S,C]=(0,a.useState)(null),D=function(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[n,i]=(0,a.useState)(null);return{generateWorkflow:(0,a.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gpt-5";if(!e.trim())return o("Please describe what you want to build a lead magnet for"),null;console.log("[Workflow Generation] Starting AI generation...",{prompt:e.trim(),timestamp:new Date().toISOString()}),t(!0),o(null),s("Creating your lead magnet..."),i(null);try{let t=Date.now(),a="".concat(window.location.origin,"/api/webhooks/workflow-completion/{jobId}"),l=await u.hi.generateWorkflowWithAI({description:e.trim(),model:r,webhook_url:a});if(l.job_id){let t=l.job_id;return console.log("[Workflow Generation] Job created",{jobId:t,status:l.status}),s("Creating your lead magnet... This may take a minute."),sessionStorage.setItem("workflow_generation_job_".concat(t),JSON.stringify({jobId:t,description:e.trim(),model:r,createdAt:new Date().toISOString()})),{job_id:t,status:"pending"}}{if(!l.result)throw Error("No result in response");let e=Date.now()-t;return console.log("[Workflow Generation] Success!",{duration:"".concat(e,"ms"),workflow:l.result.workflow,template:l.result.template,form:l.result.form,timestamp:new Date().toISOString()}),s("Generation complete!"),i(l.result),setTimeout(()=>{s(null)},3e3),l.result}}catch(e){var a,l;return console.error("[Workflow Generation] Failed:",e),o((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.message)||e.message||"Failed to generate lead magnet with AI"),s(null),null}finally{t(!1)}},[]),isGenerating:e,generationStatus:r,error:l,result:n,reset:(0,a.useCallback)(()=>{t(!1),s(null),o(null),i(null)},[])}}(),T=function(){let[e,t]=(0,a.useState)(p),[r,s]=(0,a.useState)(h),[l,o]=(0,a.useState)(x),n=(0,a.useCallback)((e,r)=>{t(t=>({...t,[e]:r}))},[]),i=(0,a.useCallback)((e,t)=>{s(r=>({...r,[e]:t}))},[]),d=(0,a.useCallback)((e,t)=>{o(r=>({...r,[e]:t}))},[]);return{formData:e,templateData:r,formFieldsData:l,updateFormData:n,updateTemplateData:i,updateFormFieldsData:d,updateFormField:(0,a.useCallback)((e,t,r)=>{o(s=>{let a=[...s.form_fields_schema.fields];return a[e]={...a[e],[t]:r},{...s,form_fields_schema:{fields:a}}})},[]),populateFromAIGeneration:(0,a.useCallback)(e=>{if(e.workflow&&t(t=>{var r,s;return{...t,workflow_name:(null===(r=e.workflow)||void 0===r?void 0:r.workflow_name)||t.workflow_name,workflow_description:(null===(s=e.workflow)||void 0===s?void 0:s.workflow_description)||t.workflow_description}}),e.template){var r,a,l,n;s({template_name:(null===(r=e.template)||void 0===r?void 0:r.template_name)||"",template_description:(null===(a=e.template)||void 0===a?void 0:a.template_description)||"",html_content:(null===(l=e.template)||void 0===l?void 0:l.html_content)||"",placeholder_tags:(null===(n=e.template)||void 0===n?void 0:n.placeholder_tags)||[]})}e.form&&o({form_name:e.form.form_name||"",public_slug:e.form.public_slug||"",form_fields_schema:e.form.form_fields_schema||{fields:[]}})},[]),reset:(0,a.useCallback)(()=>{t(p),s(h),o(x)},[])}}(),M=function(e){let[t,r]=(0,a.useState)(g),s=(0,a.useCallback)((e,t)=>{r(r=>{let s=[...r];return s[e]={...t,step_order:e},s})},[]),l=(0,a.useCallback)(()=>{r(e=>[...e,{step_name:"Step ".concat(e.length+1),step_description:"",step_type:"ai_generation",model:"gpt-5",instructions:"",step_order:e.length,tools:[],tool_choice:"auto"}])},[]),o=(0,a.useCallback)(e=>{r(t=>t.filter((t,r)=>r!==e).map((e,t)=>({...e,step_order:t})))},[]),n=(0,a.useCallback)(e=>{0!==e&&r(t=>{let r=[...t];return[r[e-1],r[e]]=[r[e],r[e-1]],r.map((e,t)=>({...e,step_order:t}))})},[]);return{steps:t,updateStep:s,addStep:l,deleteStep:o,moveStepUp:n,moveStepDown:(0,a.useCallback)(e=>{r(t=>{if(e===t.length-1)return t;let r=[...t];return[r[e],r[e+1]]=[r[e+1],r[e]],r.map((e,t)=>({...e,step_order:t}))})},[]),setStepsFromAIGeneration:(0,a.useCallback)(e=>{e&&Array.isArray(e)&&e.length>0&&r(e.map(e=>({step_name:e.step_name||"Step",step_description:e.step_description||"",model:e.model||"gpt-5",instructions:e.instructions||"",step_order:void 0!==e.step_order?e.step_order:0,tools:e.tools||[],tool_choice:e.tool_choice||"auto"})))},[]),updateFirstStepInstructions:(0,a.useCallback)(e=>{r(t=>{let r=[...t];return r.length>0&&(r[0]={...r[0],instructions:e}),r})},[]),setSteps:r}}(),L=(e=T.formData,t=M.steps,r=T.templateData,(0,a.useMemo)(()=>{let r=[];return e.workflow_name.trim()||r.push("Lead magnet name is required"),0===t.length&&r.push("At least one workflow step is required"),t.forEach((e,t)=>{e.step_name.trim()||r.push("Step ".concat(t+1," name is required")),e.instructions.trim()||r.push("Step ".concat(t+1," instructions are required"))}),{valid:0===r.length,errors:r}},[e,t,r])),E=function(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null);return{submitWorkflow:(0,a.useCallback)(async function(e,r,a,l,o,n){var i,d,c,m;let p=arguments.length>6&&void 0!==arguments[6]&&arguments[6];s(null),p||t(!0);try{let t=e.template_id;a.html_content.trim()&&(o?(await u.hi.updateTemplate(o,{template_name:a.template_name||"Generated Template",template_description:a.template_description||"",html_content:a.html_content.trim(),placeholder_tags:a.placeholder_tags.length>0?a.placeholder_tags:void 0}),t=o):(t=(await u.hi.createTemplate({template_name:a.template_name||"Generated Template",template_description:a.template_description||"",html_content:a.html_content.trim(),placeholder_tags:a.placeholder_tags.length>0?a.placeholder_tags:void 0})).template_id,n(t)));let s=e.workflow_name.trim();if(!s)throw Error("Workflow name is required");if(0===r.length)throw Error("At least one workflow step is required");r.forEach((e,t)=>{var r,s;if(!(null===(r=e.step_name)||void 0===r?void 0:r.trim()))throw Error("Step ".concat(t+1," name is required"));if(!(null===(s=e.instructions)||void 0===s?void 0:s.trim()))throw Error("Step ".concat(t+1," instructions are required"))});let c=await u.hi.createWorkflow({workflow_name:s,workflow_description:(null===(i=e.workflow_description)||void 0===i?void 0:i.trim())||"",steps:r.map((e,t)=>({...e,step_order:t,model:e.model,tools:e.tools,instructions:e.instructions.trim()})),template_id:t||void 0,template_version:e.template_version,delivery_method:e.delivery_method,delivery_webhook_url:"webhook"===e.delivery_method&&e.delivery_webhook_url?e.delivery_webhook_url:void 0,delivery_webhook_headers:"webhook"===e.delivery_method&&Object.keys(e.delivery_webhook_headers).length>0?e.delivery_webhook_headers:void 0,delivery_sms_enabled:"sms"===e.delivery_method,delivery_sms_message:"sms"===e.delivery_method&&e.delivery_sms_message?e.delivery_sms_message:void 0,delivery_sms_ai_generated:"sms"===e.delivery_method&&e.delivery_sms_ai_generated,delivery_sms_ai_instructions:"sms"===e.delivery_method&&e.delivery_sms_ai_generated&&e.delivery_sms_ai_instructions?e.delivery_sms_ai_instructions:void 0});return l.form_fields_schema.fields.length>0&&((null===(d=c.form)||void 0===d?void 0:d.form_id)?await u.hi.updateForm(c.form.form_id,{form_name:l.form_name||"Form for ".concat(e.workflow_name),public_slug:l.public_slug||e.workflow_name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),form_fields_schema:l.form_fields_schema}):await u.hi.createForm({workflow_id:c.workflow_id,form_name:l.form_name||"Form for ".concat(e.workflow_name),public_slug:l.public_slug||e.workflow_name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),form_fields_schema:l.form_fields_schema,rate_limit_enabled:!0,rate_limit_per_hour:10,captcha_enabled:!1})),c}catch(e){return console.error("Failed to create workflow:",e),s((null===(m=e.response)||void 0===m?void 0:null===(c=m.data)||void 0===c?void 0:c.message)||e.message||"Failed to create workflow"),null}finally{p||t(!1)}},[]),isSubmitting:e,error:r}}(),A=function(e){let t=(0,l.useRouter)(),[r,s]=(0,a.useState)(null),[o,n]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),c=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!e)return;let r=r=>{var a;if((null===(a=r.data)||void 0===a?void 0:a.type)==="workflow_generation_completed"){let{job_id:a,workflow_id:l,status:o}=r.data;a===e&&(console.log("[Workflow Generation Status] Webhook completion received",{jobId:e,workflowId:l,status:o}),"completed"===o&&l?(s("completed"),n(l),t.push("/dashboard/workflows/".concat(l,"/edit"))):"failed"===o&&(s("failed"),d(r.data.error_message||"Workflow generation failed")))}};return window.addEventListener("message",r),()=>{window.removeEventListener("message",r)}},[e,t]);let m=(0,a.useCallback)(async()=>{if(e)try{try{let r=await fetch("/api/webhooks/workflow-completion/".concat(e));if(r.ok){let e=await r.json();if("completed"===e.status&&e.workflow_id){s("completed"),n(e.workflow_id),t.push("/dashboard/workflows/".concat(e.workflow_id,"/edit"));return}if("failed"===e.status){s("failed"),d(e.error_message||"Workflow generation failed");return}}}catch(e){console.debug("[Workflow Generation Status] Webhook endpoint not available, using API")}let r=await u.hi.getWorkflowGenerationStatus(e);"completed"===r.status?(s("completed"),r.workflow_id?(n(r.workflow_id),t.push("/dashboard/workflows/".concat(r.workflow_id,"/edit"))):r.result&&console.warn("[Workflow Generation Status] No workflow_id in response, checking result")):"failed"===r.status?(s("failed"),d(r.error_message||"Workflow generation failed")):s(r.status)}catch(e){console.error("[Workflow Generation Status] Error polling status",e),d(e.message||"Failed to check generation status")}},[e,t]);return(0,a.useEffect)(()=>{if(!e||(c.current&&(clearInterval(c.current),c.current=null),"completed"===r||"failed"===r))return;let t=setTimeout(()=>{c.current=setInterval(()=>{m()},2e3)},5e3);return()=>{clearTimeout(t),c.current&&(clearInterval(c.current),c.current=null)}},[e,r,m]),{status:r,workflowId:o,error:i,pollStatus:m}}(S);(0,a.useEffect)(()=>{if(D.result){var e,t;let r=D.result;T.populateFromAIGeneration(r),(null===(e=r.workflow)||void 0===e?void 0:e.steps)&&Array.isArray(r.workflow.steps)&&r.workflow.steps.length>0?M.setStepsFromAIGeneration(r.workflow.steps):(null===(t=r.workflow)||void 0===t?void 0:t.research_instructions)&&M.updateFirstStepInstructions(r.workflow.research_instructions),w("form")}},[D.result]),(0,a.useEffect)(()=>{D.error&&N(D.error),E.error&&N(E.error)},[D.error,E.error]);let F=async()=>{if(!_.trim()){N("Please describe what you want to build a lead magnet for");return}N(null),w("creating");let e=await D.generateWorkflow(_.trim(),"gpt-5");e&&e.job_id?C(e.job_id):e&&D.generationStatus&&setTimeout(()=>{},5e3)};(0,a.useEffect)(()=>{"completed"===A.status&&A.workflowId?w("form"):"failed"===A.status&&(N(A.error||"Workflow generation failed"),w("prompt"),C(null))},[A.status,A.workflowId,A.error]);let I=async e=>{if(e.preventDefault(),!L.valid){N(L.errors[0]);return}N(null),await E.submitWorkflow(T.formData,M.steps,T.templateData,T.formFieldsData,v,j,!1)&&f.push("/dashboard/workflows")};return"creating"===b?(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-ink-900",children:"Creating Your Lead Magnet"}),(0,s.jsx)("p",{className:"text-ink-600",children:"AI is generating your lead magnet configuration..."})]}),k&&(0,s.jsx)("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:k}),(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6",children:(0,s.jsx)("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-8 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-brand-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-ink-900 mb-2",children:D.generationStatus||"Creating your lead magnet..."}),(0,s.jsx)("p",{className:"text-sm text-ink-600",children:"This may take a minute. We'll automatically take you to the edit page when it's ready."}),S&&(0,s.jsxs)("p",{className:"text-xs text-ink-500 mt-2 font-mono",children:["Job ID: ",S]})]})]})})})]}):"prompt"===b?(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-ink-900",children:"Create Lead Magnet"}),(0,s.jsx)("p",{className:"text-ink-600",children:"Describe what you want to build, and AI will generate everything for you"})]}),k&&(0,s.jsx)("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:k}),(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6",children:(0,s.jsxs)("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-6 mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-ink-900 mb-2 flex items-center",children:[(0,s.jsx)(o.Wqx,{className:"w-5 h-5 mr-2 text-brand-600 ".concat(D.isGenerating?"animate-pulse":"")}),"What do you want to build?"]}),(0,s.jsx)("p",{className:"text-sm text-ink-600 mb-4",children:"Describe your lead magnet idea. AI will generate the name, description, research instructions, and template HTML for you."}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("textarea",{value:_,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-white/60 rounded-2xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:bg-ink-100 disabled:cursor-not-allowed shadow-soft",placeholder:"e.g., A course idea validator that analyzes market demand, competition, target audience, and provides actionable recommendations for course creators...",rows:6,disabled:D.isGenerating}),D.generationStatus&&(0,s.jsxs)("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-3 flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-brand-600 mr-3"}),(0,s.jsx)("span",{className:"text-sm text-brand-800 font-medium",children:D.generationStatus})]}),(0,s.jsx)("button",{type:"button",onClick:F,disabled:D.isGenerating||!_.trim(),className:"flex items-center justify-center px-6 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:D.isGenerating?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),(0,s.jsx)("span",{children:"Generating..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Wqx,{className:"w-5 h-5 mr-2"}),(0,s.jsx)("span",{children:"Generate Lead Magnet"})]})})]})]})})]}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-ink-900",children:"Create Lead Magnet"}),(0,s.jsx)("p",{className:"text-ink-600",children:"Review and edit the generated configuration"})]}),k&&(0,s.jsx)("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:k}),D.generationStatus&&(0,s.jsx)("div",{className:"mb-6 bg-emerald-50/80 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-2xl",children:D.generationStatus}),(0,s.jsxs)("div",{className:"mb-6 bg-brand-50/80 border border-brand-200 rounded-2xl p-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-brand-900 mb-2",children:"Processing Modes"}),(0,s.jsx)("p",{className:"text-sm text-brand-800 mb-2",children:"Choose how your lead magnet is generated:"}),(0,s.jsxs)("ul",{className:"text-sm text-brand-800 space-y-1 list-disc list-inside",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Research + HTML:"})," AI generates personalized research, then converts it to styled HTML"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Research Only:"})," AI generates research report (markdown format)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"HTML Only:"})," AI generates styled HTML directly from form submission"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Text Only:"})," Simple text output from form submission"]})]})]}),(0,s.jsxs)("form",{onSubmit:I,className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6 space-y-6","data-tour":"workflow-form",children:[(0,s.jsx)(i,{formData:T.formData,onChange:T.updateFormData}),(0,s.jsxs)("div",{className:"space-y-4 pt-6 border-t","data-tour":"workflow-steps",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-ink-900",children:"Workflow Steps"}),(0,s.jsxs)("button",{type:"button",onClick:M.addStep,className:"flex items-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft touch-target",children:[(0,s.jsx)(o.OvN,{className:"w-4 h-4"}),"Add Step"]})]}),(0,s.jsx)("p",{className:"text-sm text-ink-600 mb-4",children:"Define the steps your workflow will execute. Each step receives context from all previous steps."}),(0,s.jsx)("div",{className:"space-y-4",children:M.steps.map((e,t)=>(0,s.jsx)(n.Z,{step:e,index:t,totalSteps:M.steps.length,allSteps:M.steps,onChange:M.updateStep,onDelete:M.deleteStep,onMoveUp:M.moveStepUp,onMoveDown:M.moveStepDown},t))})]}),(T.formData.template_id||T.templateData.html_content.trim())&&(0,s.jsx)(d,{templateData:T.templateData,onChange:T.updateTemplateData}),T.formFieldsData.form_fields_schema.fields.length>0&&(0,s.jsx)(c,{formFieldsData:T.formFieldsData,onChange:T.updateFormFieldsData,onFieldChange:T.updateFormField}),(0,s.jsx)(m,{formData:T.formData,onChange:T.updateFormData}),(0,s.jsx)("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:(0,s.jsxs)("button",{type:"submit",disabled:E.isSubmitting,className:"flex items-center px-6 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft disabled:opacity-50 disabled:cursor-not-allowed","data-tour":"create-workflow-button",children:[(0,s.jsx)(o.mW3,{className:"w-5 h-5 mr-2"}),E.isSubmitting?"Creating...":"Create Lead Magnet"]})})]})]})}},58504:function(e,t,r){"use strict";var s=r(93226);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[9134,9190,440,3951,9742,7115,2364,1744],function(){return e(e.s=98771)}),_N_E=e.O()}]);