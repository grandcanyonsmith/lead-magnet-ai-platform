(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7831],{61075:function(e,t,s){Promise.resolve().then(s.bind(s,45753)),Promise.resolve().then(s.bind(s,61653))},45753:function(e,t,s){"use strict";s.d(t,{default:function(){return m}});var a=s(37821),r=s(58078),l=s(58504),i=s(63951),o=s(78972);function n(e){let t=e.matchAll(/\{\{([A-Z_]+)\}\}/g),s=new Set;for(let e of t)s.add(e[1]);return Array.from(s).sort()}var d=s(77851),c=s(75841);function m(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)(null),{workflowId:m,loading:x,submitting:h,setSubmitting:u,error:p,setError:f,formData:b,setFormData:_,steps:g,setSteps:w,formId:v,workflowForm:j,handleChange:k,handleStepChange:y,handleAddStep:N,handleDeleteStep:C,handleMoveStepUp:S,handleMoveStepDown:F,router:T}=function(){let e=(0,l.useRouter)(),t=(0,o.I)(),[s,a]=(0,r.useState)(!0),[n,d]=(0,r.useState)(!1),[c,m]=(0,r.useState)(null),[x,h]=(0,r.useState)({workflow_name:"",workflow_description:"",template_id:"",template_version:0,delivery_method:"none",delivery_webhook_url:"",delivery_webhook_headers:{},delivery_sms_enabled:!1,delivery_sms_message:"",delivery_sms_ai_generated:!1,delivery_sms_ai_instructions:""}),[u,p]=(0,r.useState)([]),[f,b]=(0,r.useState)(null),[_,g]=(0,r.useState)(null),[w,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&j()},[t]);let j=async()=>{try{let e=await i.hi.getWorkflow(t);if(h({workflow_name:e.workflow_name||"",workflow_description:e.workflow_description||"",template_id:e.template_id||"",template_version:e.template_version||0,delivery_method:e.delivery_method||"none",delivery_webhook_url:e.delivery_webhook_url||"",delivery_webhook_headers:e.delivery_webhook_headers||{},delivery_sms_enabled:e.delivery_sms_enabled||!1,delivery_sms_message:e.delivery_sms_message||"",delivery_sms_ai_generated:e.delivery_sms_ai_generated||!1,delivery_sms_ai_instructions:e.delivery_sms_ai_instructions||""}),!e.steps||0===e.steps.length)throw Error("Workflow has no steps. Legacy format is no longer supported.");let s=e.steps.map((e,t)=>{var s;let a="";a=e.step_name&&e.step_name.toLowerCase().includes("html")?"Rewrite the content into styled HTML matching the provided template. Ensure the output is complete, valid HTML that matches the template's design and structure.":e.step_name&&e.step_name.toLowerCase().includes("research")?"Generate a comprehensive research report based on the form submission data.":"Process the input data according to the workflow requirements.";let r=e.step_type||"ai_generation";return{step_name:e.step_name||"Step ".concat(t+1),step_description:e.step_description||"",step_type:r,model:e.model||"gpt-5",instructions:(null===(s=e.instructions)||void 0===s?void 0:s.trim())||("webhook"===r?"":a),step_order:void 0!==e.step_order?e.step_order:t,tools:e.tools||("webhook"===r?[]:["web_search_preview"]),tool_choice:e.tool_choice||"auto",depends_on:e.depends_on||[],webhook_url:e.webhook_url||"",webhook_headers:e.webhook_headers||{},webhook_data_selection:e.webhook_data_selection||("webhook"===r?{include_submission:!0,exclude_step_indices:[],include_job_info:!0}:void 0)}});p(s),e.form&&(b(e.form.form_id),g(e.form)),v(e.status||"active")}catch(t){var e,s;console.error("Failed to load workflow:",t),m((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||t.message||"Failed to load workflow")}finally{a(!1)}};return{workflowId:t,loading:s,submitting:n,setSubmitting:d,error:c,setError:m,formData:x,setFormData:h,steps:u,setSteps:p,formId:f,workflowForm:_,workflowStatus:w,handleChange:(e,t)=>{h(s=>({...s,[e]:t}))},handleStepChange:(e,t)=>{p(s=>{let a=[...s];return a[e]={...t,step_order:e},a})},handleAddStep:()=>{p(e=>[...e,{step_name:"Step ".concat(e.length+1),step_description:"",step_type:"ai_generation",model:"gpt-5",instructions:"",step_order:e.length,tools:["web_search_preview"],tool_choice:"auto",depends_on:[]}])},handleDeleteStep:e=>{p(t=>t.filter((t,s)=>s!==e).map((e,t)=>({...e,step_order:t})))},handleMoveStepUp:e=>{0!==e&&p(t=>{let s=[...t];return[s[e-1],s[e]]=[s[e],s[e-1]],s.map((e,t)=>({...e,step_order:t}))})},handleMoveStepDown:e=>{e!==u.length-1&&p(t=>{let s=[...t];return[s[e],s[e+1]]=[s[e+1],s[e]],s.map((e,t)=>({...e,step_order:t}))})},router:e}}(),{formFormData:D,handleFormChange:L,handleFieldChange:E,addField:P,removeField:A}=function(e,t,s){let[a,l]=(0,r.useState)({form_name:"",public_slug:"",form_fields_schema:{fields:[]},rate_limit_enabled:!0,rate_limit_per_hour:10,captcha_enabled:!1,custom_css:"",thank_you_message:"",redirect_url:""});return(0,r.useEffect)(()=>{s&&l({form_name:s.form_name||"",public_slug:s.public_slug||"",form_fields_schema:s.form_fields_schema||{fields:[]},rate_limit_enabled:void 0===s.rate_limit_enabled||s.rate_limit_enabled,rate_limit_per_hour:s.rate_limit_per_hour||10,captcha_enabled:s.captcha_enabled||!1,custom_css:s.custom_css||"",thank_you_message:s.thank_you_message||"",redirect_url:s.redirect_url||""})},[s]),(0,r.useEffect)(()=>{e&&(a.form_name==="".concat(e," Form")||!a.form_name)&&l(t=>({...t,form_name:"".concat(e," Form")}))},[e]),{formFormData:a,setFormFormData:l,handleFormChange:(e,t)=>{l(s=>({...s,[e]:t}))},handleFieldChange:(e,t,s)=>{l(a=>{let r=[...a.form_fields_schema.fields];return r[e]={...r[e],[t]:s},{...a,form_fields_schema:{...a.form_fields_schema,fields:r}}})},addField:()=>{l(e=>({...e,form_fields_schema:{...e.form_fields_schema,fields:[...e.form_fields_schema.fields,{field_id:"field_".concat(Date.now()),field_type:"text",label:"",placeholder:"",required:!1}]}}))},removeField:e=>{l(t=>{let s=[...t.form_fields_schema.fields];return s.splice(e,1),{...t,form_fields_schema:{...t.form_fields_schema,fields:s}}})},moveFieldUp:e=>{0!==e&&l(t=>{let s=[...t.form_fields_schema.fields],a=s[e];return s[e]=s[e-1],s[e-1]=a,{...t,form_fields_schema:{...t.form_fields_schema,fields:s}}})},moveFieldDown:e=>{l(t=>{let s=[...t.form_fields_schema.fields];if(e>=s.length-1)return t;let a=s[e];return s[e]=s[e+1],s[e+1]=a,{...t,form_fields_schema:{...t.form_fields_schema,fields:s}}})}}}(b.workflow_name,0,j),{templateLoading:R,templateData:M,handleTemplateChange:q}=function(e,t,s){let[a,l]=(0,r.useState)(!1),[o,d]=(0,r.useState)({template_name:"",template_description:"",html_content:"",is_published:!1}),[c,m]=(0,r.useState)([]),[x,h]=(0,r.useState)(!1),[u,p]=(0,r.useState)(0),[f,b]=(0,r.useState)("split"),[_,g]=(0,r.useState)("desktop"),[w,v]=(0,r.useState)(!1),[j,k]=(0,r.useState)(null),[y,N]=(0,r.useState)("");(0,r.useEffect)(()=>{s&&!t?C(s):!s&&e&&d(t=>({...t,template_name:"".concat(e||"Lead Magnet"," Template")}))},[s,e]),(0,r.useEffect)(()=>{!e||t||o.template_name!=="".concat(e," Template")&&o.template_name||d(t=>({...t,template_name:"".concat(e||"Lead Magnet"," Template")}))},[e,t]);let C=async e=>{l(!0);try{let t=await i.hi.getTemplate(e);if(d({template_name:t.template_name||"",template_description:t.template_description||"",html_content:t.html_content||"",is_published:t.is_published||!1}),t.html_content){let e=n(t.html_content);m(e),t.html_content.trim()&&!x&&(h(!0),p(1))}}catch(e){console.error("Failed to load template:",e)}finally{l(!1)}},S=async()=>{if(!y.trim())return{error:"Please describe what changes you want to make"};if(!o.html_content.trim())return{error:"No HTML content to refine"};v(!0),k("Refining template with AI...");try{let e=(await i.hi.refineTemplateWithAI({current_html:o.html_content,edit_prompt:y.trim(),model:"gpt-5"})).html_content;d(t=>({...t,html_content:e}));let t=n(e);return m(t),p(e=>e+1),x||h(!0),N(""),setTimeout(()=>{k(null)},2e3),{success:!0}}catch(s){var e,t;return{error:(null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||s.message||"Failed to refine template with AI"}}finally{v(!1)}};return{templateLoading:a,templateData:o,setTemplateData:d,detectedPlaceholders:c,showPreview:x,setShowPreview:h,previewKey:u,templateViewMode:f,setTemplateViewMode:b,devicePreviewSize:_,setDevicePreviewSize:g,refining:w,generationStatus:j,editPrompt:y,setEditPrompt:N,handleTemplateChange:(e,t)=>{d(s=>({...s,[e]:t}))},handleHtmlChange:e=>{d(t=>({...t,html_content:e})),m(n(e)),p(e=>e+1),e.trim()&&!x&&h(!0)},handleRefine:S,insertPlaceholder:e=>{let t="{{".concat(e,"}}");d(e=>({...e,html_content:e.html_content+t}))},loadTemplate:C}}(b.workflow_name,t,b.template_id);(0,r.useEffect)(()=>{b.template_id&&!t&&s(b.template_id)},[b.template_id,t]);let I=async a=>{if(a.preventDefault(),f(null),!b.workflow_name.trim()){f("Lead magnet name is required");return}if(0===g.length){f("At least one step is required");return}for(let e=0;e<g.length;e++){let t=g[e];if(!t.step_name.trim()){f("Step ".concat(e+1," name is required"));return}if("webhook"===t.step_type){if(!t.webhook_url||!t.webhook_url.trim()){f("Step ".concat(e+1," webhook URL is required"));return}}else if(!t.instructions||!t.instructions.trim()){f("Step ".concat(e+1," instructions are required"));return}}u(!0);try{let a=t;if(M.html_content.trim()){let e=n(M.html_content);if(t)await i.hi.updateTemplate(t,{template_name:M.template_name.trim(),template_description:M.template_description.trim(),html_content:M.html_content.trim(),placeholder_tags:e.length>0?e:void 0});else{let t=await i.hi.createTemplate({template_name:M.template_name.trim(),template_description:M.template_description.trim(),html_content:M.html_content.trim(),placeholder_tags:e.length>0?e:void 0});a=t.template_id,s(t.template_id)}}await i.hi.updateWorkflow(m,{workflow_name:b.workflow_name.trim(),workflow_description:b.workflow_description.trim()||void 0,steps:g.map((e,t)=>({...e,step_order:t,model:e.model})),template_id:a||void 0,template_version:0}),v&&await i.hi.updateForm(v,{form_name:D.form_name.trim(),public_slug:D.public_slug.trim(),form_fields_schema:D.form_fields_schema}),e.push("/dashboard/workflows")}catch(e){var r,l;console.error("Failed to update:",e),f((null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||e.message||"Failed to update")}finally{u(!1)}};return x||R?(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-ink-600",children:"Loading..."})})}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h1",{className:"text-2xl font-bold text-ink-900",children:"Edit Lead Magnet"})}),p&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:p}),(0,a.jsxs)("form",{onSubmit:I,className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-white/60 p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:["Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:b.workflow_name,onChange:e=>k("workflow_name",e.target.value),className:"w-full px-4 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:b.workflow_description,onChange:e=>k("workflow_description",e.target.value),className:"w-full px-4 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500 focus:border-transparent",rows:3})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-white/60 p-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-ink-900",children:"Steps"}),(0,a.jsxs)("button",{type:"button",onClick:N,className:"flex items-center px-3 py-1.5 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 text-sm",children:[(0,a.jsx)(d.OvN,{className:"w-4 h-4 mr-1"}),"Add Step"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:g.map((e,t)=>(0,a.jsx)(c.Z,{step:e,index:t,totalSteps:g.length,allSteps:g,onChange:y,onDelete:C,onMoveUp:S,onMoveDown:F,workflowId:m},"step-".concat(t,"-").concat(e.step_name,"-").concat(e.step_type||"ai")))})]}),v&&(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-white/60 p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-ink-900",children:"Form"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:"Form Name"}),(0,a.jsx)("input",{type:"text",value:D.form_name,onChange:e=>L("form_name",e.target.value),className:"w-full px-4 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700",children:"Fields"}),(0,a.jsxs)("button",{type:"button",onClick:P,className:"flex items-center px-3 py-1.5 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 text-sm",children:[(0,a.jsx)(d.OvN,{className:"w-4 h-4 mr-1"}),"Add Field"]})]}),(0,a.jsx)("div",{className:"space-y-3",children:D.form_fields_schema.fields.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-2 items-start border border-white/60 rounded-2xl p-3",children:[(0,a.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-2",children:[(0,a.jsx)("input",{type:"text",value:e.label,onChange:e=>E(t,"label",e.target.value),placeholder:"Label",className:"px-3 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500"}),(0,a.jsxs)("select",{value:e.field_type,onChange:e=>E(t,"field_type",e.target.value),className:"px-3 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500",children:[(0,a.jsx)("option",{value:"text",children:"Text"}),(0,a.jsx)("option",{value:"email",children:"Email"}),(0,a.jsx)("option",{value:"textarea",children:"Textarea"}),(0,a.jsx)("option",{value:"number",children:"Number"}),(0,a.jsx)("option",{value:"select",children:"Select"})]})]}),(0,a.jsx)("button",{type:"button",onClick:()=>A(t),className:"p-2 text-red-600 hover:bg-red-50 rounded-2xl",children:(0,a.jsx)(d.Ybf,{className:"w-4 h-4"})})]},t))})]})]}),(t||M.html_content.trim())&&(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-white/60 p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-ink-900",children:"Template"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:"Template Name"}),(0,a.jsx)("input",{type:"text",value:M.template_name,onChange:e=>q("template_name",e.target.value),className:"w-full px-4 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:"HTML Content"}),(0,a.jsx)("textarea",{value:M.html_content,onChange:e=>q("html_content",e.target.value),className:"w-full px-4 py-2 border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500 font-mono text-sm",rows:20})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>e.back(),className:"px-6 py-2.5 border border-white/60 rounded-2xl hover:bg-white/90",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",disabled:h,className:"flex items-center px-6 py-2.5 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(d.mW3,{className:"w-5 h-5 mr-2"}),h?"Saving...":"Save"]})]})]})]})}},61653:function(e,t,s){"use strict";s.d(t,{default:function(){return c}});var a=s(37821),r=s(58078),l=s(58504),i=s(63951),o=s(77851),n=s(78972),d=s(96780);function c(){let e=(0,l.useRouter)(),t=(0,n.I)(),[s,c]=(0,r.useState)(null),[m,x]=(0,r.useState)([]),[h,u]=(0,r.useState)({}),[p,f]=(0,r.useState)(!0),[b,_]=(0,r.useState)(null),[g,w]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[k,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&""!==t.trim()&&"_"!==t&&Promise.all([N(t),C(t)])},[t]);let N=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;try{let t=await i.hi.getWorkflow(e);c(t),_(null)}catch(e){var s,a;console.error("Failed to load workflow:",e),_((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||e.message||"Failed to load workflow"),f(!1)}},C=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;try{let t=(await i.hi.getJobs({workflow_id:e,limit:10})).jobs||[];x(t);let s={};for(let e of t)if(e.submission_id)try{let t=await i.hi.getSubmission(e.submission_id);s[e.job_id]=t}catch(t){console.error("Failed to load submission for job ".concat(e.job_id,":"),t)}u(s)}catch(e){console.error("Failed to load jobs:",e)}finally{f(!1)}},S=async()=>{y(!0);try{await i.hi.deleteWorkflow(t),e.push("/dashboard/workflows")}catch(e){var s,a;console.error("Failed to delete workflow:",e),_((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||e.message||"Failed to delete workflow")}finally{y(!1),j(!1)}},F=async()=>{if(s){w(!0),_(null);try{let e=s.workflow_name.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),a={workflow_id:t,form_name:"".concat(s.workflow_name," Form"),public_slug:e||"form-".concat(t.slice(-8)),form_fields_schema:{fields:[{field_id:"field_1",field_type:"text",label:"Name",placeholder:"Your name",required:!0},{field_id:"field_2",field_type:"email",label:"Email",placeholder:"your@email.com",required:!0},{field_id:"field_3",field_type:"text",label:"Industry",placeholder:"Your industry",required:!1},{field_id:"field_4",field_type:"textarea",label:"Description",placeholder:"Tell us about your needs",required:!1},{field_id:"field_5",field_type:"tel",label:"Phone",placeholder:"Your phone number",required:!1}]},rate_limit_enabled:!0,rate_limit_per_hour:10,captcha_enabled:!1};await i.hi.createForm(a),await N()}catch(t){var e,a;console.error("Failed to create form:",t),_((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||t.message||"Failed to create form")}finally{w(!1)}}};return p?(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-ink-600",children:"Loading workflow..."})})}):b&&!s?(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("button",{onClick:()=>e.back(),className:"flex items-center text-ink-600 hover:text-ink-900 mb-4",children:[(0,a.jsx)(o.Ao2,{className:"w-4 h-4 mr-2"}),"Back"]})}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:b})]}):s?(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 text-sm text-ink-600",children:(0,a.jsxs)("button",{onClick:()=>e.back(),className:"inline-flex items-center gap-2 px-3 py-2 rounded-2xl bg-white border border-white/60 shadow-soft hover:bg-white/80 transition-colors touch-target",children:[(0,a.jsx)(o.Ao2,{className:"w-4 h-4"}),"Back"]})}),b&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl text-sm sm:text-base",children:b}),(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-5 sm:p-6",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-ink-900",children:s.workflow_name}),s.workflow_description&&(0,a.jsx)("p",{className:"text-sm sm:text-base text-ink-600",children:s.workflow_description}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 text-xs text-ink-600",children:[s.status&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full border border-white/60 bg-surface-50 font-medium",children:["Status: ",s.status]}),s.template_version&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full border border-white/60 bg-surface-50 font-medium",children:["Template v",s.template_version]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/dashboard/workflows/".concat(t,"/edit")),className:"flex items-center justify-center px-4 py-3 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors text-sm sm:text-base touch-target shadow-soft",children:[(0,a.jsx)(o.vPQ,{className:"w-4 h-4 mr-2"}),"Edit"]}),(0,a.jsxs)("button",{onClick:()=>j(!0),className:"flex items-center justify-center px-4 py-3 bg-red-600 text-white rounded-2xl hover:bg-red-700 transition-colors text-sm sm:text-base touch-target",children:[(0,a.jsx)(o.Ybf,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,a.jsx)(o.nbt,{className:"w-5 h-5 text-ink-600"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-ink-900",children:"Workflow Details"})]}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-ink-500 uppercase tracking-wide mb-2",children:"Template ID"}),(0,a.jsxs)("div",{className:"bg-surface-50 rounded-2xl p-3 border border-white/60",children:[(0,a.jsx)("p",{className:"text-xs font-mono text-ink-900 break-all",children:s.template_id||"-"}),s.template_version&&(0,a.jsxs)("p",{className:"text-xs text-ink-500 mt-1",children:["Version ",s.template_version]})]})]}),(0,a.jsxs)("div",{className:"pb-4 border-b border-white/60",children:[(0,a.jsxs)("label",{className:"flex items-center gap-1.5 text-xs font-semibold text-ink-500 uppercase tracking-wide mb-3",children:[(0,a.jsx)(o.NOg,{className:"w-3.5 h-3.5"}),"Form"]}),s.form?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-surface-50 rounded-2xl p-3 border border-white/60",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-ink-900 break-words",children:s.form.form_name||"Form"}),s.form.public_slug&&(0,a.jsxs)("p",{className:"text-xs text-ink-500 mt-1 font-mono break-all",children:["/",s.form.public_slug]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[s.form.public_slug&&(0,a.jsxs)("a",{href:"/v1/forms/".concat(s.form.public_slug),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors touch-target shadow-soft",children:[(0,a.jsx)(o.AlO,{className:"w-4 h-4 mr-1.5"}),"View Form"]}),s.form.form_id&&(0,a.jsxs)("button",{onClick:()=>e.push("/dashboard/forms/".concat(s.form.form_id,"/edit")),className:"inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium border border-white/60 text-ink-700 rounded-2xl hover:bg-surface-100 transition-colors touch-target",children:[(0,a.jsx)(o.vPQ,{className:"w-4 h-4 mr-1.5"}),"Edit Form"]})]}),s.form.public_slug&&(0,a.jsxs)("div",{className:"bg-brand-50/70 border border-brand-100 rounded-2xl p-3",children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-brand-900 mb-2",children:"Public Form URL"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"text",readOnly:!0,value:"".concat(window.location.origin,"/v1/forms/").concat(s.form.public_slug),className:"flex-1 text-xs font-mono bg-white border border-brand-200 rounded-2xl px-3 py-2 text-ink-900 break-all focus:outline-none focus:ring-2 focus:ring-brand-500",onClick:e=>e.target.select()}),(0,a.jsx)("button",{onClick:()=>{let e="".concat(window.location.origin,"/v1/forms/").concat(s.form.public_slug);navigator.clipboard.writeText(e)},className:"p-2.5 text-brand-700 hover:text-brand-900 hover:bg-brand-100 rounded-2xl transition-colors flex-shrink-0 touch-target border border-brand-200",title:"Copy URL",children:(0,a.jsx)(o.C3L,{className:"w-4 h-4"})})]})]})]}):(0,a.jsxs)("div",{className:"bg-surface-50 rounded-2xl p-4 border border-white/60 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-ink-600 mb-3",children:"No form attached to this lead magnet yet."}),(0,a.jsx)("button",{onClick:F,disabled:g,className:"inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed touch-target shadow-soft",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.TCC,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.XKb,{className:"w-4 h-4 mr-2"}),"Create Form"]})})]})]}),s.delivery_webhook_url&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-ink-500 uppercase tracking-wide mb-2",children:"Webhook URL"}),(0,a.jsx)("div",{className:"bg-surface-50 rounded-2xl p-3 border border-white/60",children:(0,a.jsx)("p",{className:"text-xs font-mono text-ink-900 break-all",children:s.delivery_webhook_url})})]}),s.delivery_phone&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-ink-500 uppercase tracking-wide mb-2",children:"Delivery Phone"}),(0,a.jsx)("p",{className:"text-sm font-medium text-ink-900 break-words",children:s.delivery_phone})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-white/60",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-xs font-semibold text-ink-500 uppercase tracking-wide mb-3",children:[(0,a.jsx)(o.vlc,{className:"w-3.5 h-3.5"}),"Timeline"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-ink-500 mb-1",children:"Created"}),(0,a.jsx)("p",{className:"text-sm font-medium text-ink-900",children:s.created_at?new Date(s.created_at).toLocaleString():"-"})]}),s.updated_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-ink-500 mb-1",children:"Last Updated"}),(0,a.jsx)("p",{className:"text-sm font-medium text-ink-900",children:new Date(s.updated_at).toLocaleString()})]})]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-6 bg-white rounded-2xl shadow-soft border border-white/60 p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,a.jsx)(o.TCC,{className:"w-5 h-5 text-ink-600"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-ink-900",children:"Recent Jobs"})]}),0===m.length?(0,a.jsx)("p",{className:"text-ink-500 text-sm",children:"No jobs found for this workflow"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-white/60",children:[(0,a.jsx)("thead",{className:"bg-surface-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Job ID"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Duration"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Submission"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-white/60",children:m.map(t=>{let s=t.completed_at?Math.round((new Date(t.completed_at).getTime()-new Date(t.created_at).getTime())/1e3):null,r=h[t.job_id];return(0,a.jsxs)("tr",{className:"hover:bg-surface-50",children:[(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,a.jsx)("button",{onClick:()=>e.push("/dashboard/jobs/".concat(t.job_id)),className:"text-xs font-mono text-ink-900 hover:text-brand-600 transition-colors text-left",children:t.job_id})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-ink-600",children:new Date(t.created_at).toLocaleString()}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-ink-600",children:null!==s?"".concat(s,"s"):"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-ink-600",children:r&&r.submission_data?(0,a.jsx)("div",{className:"max-w-xs",children:(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(r.submission_data).slice(0,4).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsxs)("span",{className:"font-medium text-ink-500",children:[t,":"]})," ",(0,a.jsxs)("span",{className:"text-ink-900",children:[String(s).substring(0,20),String(s).length>20?"...":""]})]},t)})})}):(0,a.jsx)("span",{className:"text-ink-300",children:"-"})}),(0,a.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm",children:(0,a.jsx)("button",{onClick:()=>e.push("/dashboard/jobs/".concat(t.job_id)),className:"text-brand-600 hover:text-brand-700 hover:bg-brand-50 px-3 py-1.5 rounded-2xl transition-colors",children:"View"})})]},t.job_id)})})]})})]}),(0,a.jsx)(d.Q,{open:v,title:"Delete lead magnet?",description:(0,a.jsxs)("span",{children:["This will delete ",(0,a.jsx)("span",{className:"font-semibold",children:s.workflow_name})," and its associated form. This action cannot be undone."]}),confirmLabel:"Delete",tone:"danger",loading:k,onConfirm:S,onCancel:()=>j(!1)})]}):null}},75841:function(e,t,s){"use strict";s.d(t,{Z:function(){return m}});var a=s(37821),r=s(77851),l=s(69526),i=s(16058),o=s(96490),n=s(91309),d=s(12700),c=s(97917);function m(e){let{step:t,index:s,totalSteps:m,allSteps:x=[],onChange:h,onDelete:u,onMoveUp:p,onMoveDown:f,workflowId:b}=e,{localStep:_,webhookHeaders:g,handleChange:w,handleWebhookHeadersChange:v}=(0,d.x)({step:t,index:s,onChange:h}),{computerUseConfig:j,isToolSelected:k,handleToolToggle:y,handleComputerUseConfigChange:N}=(0,c.t)({step:_,onChange:w});return(0,a.jsxs)("div",{className:"border border-gray-300 rounded-lg p-6 bg-white shadow-sm",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),e.stopPropagation())},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-1 text-gray-400",children:(0,a.jsx)("span",{className:"text-xs",children:"⋮⋮"})}),(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Step ",s+1]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>p(s),disabled:0===s,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step up",children:(0,a.jsx)(r.rH8,{className:"w-5 h-5"})}),(0,a.jsx)("button",{type:"button",onClick:()=>f(s),disabled:s===m-1,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step down",children:(0,a.jsx)(r.bTu,{className:"w-5 h-5"})}),(0,a.jsx)("button",{type:"button",onClick:()=>u(s),className:"p-2 text-red-600 hover:text-red-700 touch-target","aria-label":"Delete step",children:(0,a.jsx)(r.Ybf,{className:"w-5 h-5"})})]})]}),(0,a.jsx)(n.E,{workflowId:b,step:_,stepIndex:s,onAccept:e=>{h(s,e)}}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(l.b,{step:_,onChange:w}),("ai_generation"===_.step_type||!_.step_type)&&(0,a.jsx)(i.b,{step:_,isToolSelected:k,onToolToggle:y,onToolChoiceChange:e=>w("tool_choice",e),onComputerUseConfigChange:N,computerUseConfig:j}),(()=>{let e="webhook"===_.step_type;return console.log("[WorkflowStepEditor] Rendering step",s,"step_type:",_.step_type,"isWebhook:",e),e&&(0,a.jsx)(o.E,{step:_,webhookHeaders:g,allSteps:x,currentStepIndex:s,onChange:w,onWebhookHeadersChange:v})})(),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dependencies (optional)"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Select which steps must complete before this step runs. Leave empty to auto-detect from step order."}),(0,a.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3",children:x.length>0?x.map((e,t)=>{if(t===s)return null;let r=(_.depends_on||[]).includes(t);return(0,a.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:r,onChange:e=>{let s=_.depends_on||[];w("depends_on",e.target.checked?[...s,t]:s.filter(e=>e!==t))},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["Step ",t+1,": ",e.step_name]})]},t)}):(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No other steps available"})}),_.depends_on&&_.depends_on.length>0&&(0,a.jsxs)("p",{className:"mt-2 text-xs text-gray-600",children:["Depends on: ",_.depends_on.map(e=>"Step ".concat(e+1)).join(", ")]})]})]})]})}},78972:function(e,t,s){"use strict";s.d(t,{I:function(){return l}});var a=s(58504),r=s(58078);function l(){let e=(0,a.useParams)(),t=(0,r.useCallback)(()=>{var t;let s=null==e?void 0:e.slug,a=null!==(t=(Array.isArray(s)?s[0]:s)||(null==e?void 0:e.id))&&void 0!==t?t:"";if(a&&"_"!==a)return a;{let e=window.location.pathname.match(/\/dashboard\/workflows\/([^/]+)/);if(e&&e[1]&&"_"!==e[1])return e[1]}return""},[e]),[s,l]=(0,r.useState)(()=>t());return(0,r.useEffect)(()=>{let e=t();e&&e!==s&&""!==e.trim()&&"_"!==e&&l(e)},[t,s]),s}},96780:function(e,t,s){"use strict";s.d(t,{Q:function(){return r}});var a=s(37821);function r(e){let{open:t,title:s,description:r,confirmLabel:l="Confirm",cancelLabel:i="Cancel",tone:o="default",loading:n=!1,onConfirm:d,onCancel:c}=e;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-ink-900/60 backdrop-blur-sm",onClick:c,"aria-hidden":"true"}),(0,a.jsx)("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white shadow-soft border border-white/60 p-6",role:"dialog","aria-modal":"true","aria-labelledby":"confirm-dialog-title",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{id:"confirm-dialog-title",className:"text-lg font-semibold text-ink-900",children:s}),r&&(0,a.jsx)("div",{className:"text-sm text-ink-600",children:r})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-end gap-2 sm:gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:c,className:"w-full sm:w-auto px-4 py-3 sm:py-2.5 rounded-2xl border border-white/60 bg-white text-ink-700 hover:bg-surface-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 touch-target",children:i}),(0,a.jsx)("button",{type:"button",onClick:d,disabled:n,className:"w-full sm:w-auto px-4 py-3 sm:py-2.5 rounded-2xl text-white ".concat("danger"===o?"bg-red-600 hover:bg-red-700 focus:ring-red-500":"bg-brand-600 hover:bg-brand-700 focus:ring-brand-500"," transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 touch-target disabled:opacity-60 disabled:cursor-not-allowed"),children:n?"Working...":l})]})]})})]}):null}},58504:function(e,t,s){"use strict";var a=s(93226);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[9134,9190,440,3951,9742,7115,2364,1744],function(){return e(e.s=61075)}),_N_E=e.O()}]);