(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8594],{7288:function(e,s,t){Promise.resolve().then(t.bind(t,34433))},34433:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var a=t(37821),r=t(58078),n=t(58504),l=t(45755),i=t(87559),o=t(70699),c=t(38409),d=t(63951),x=t(77851),m=t(16028);let u=[{value:"USER",label:"USER",icon:x.fzv,color:"text-ink-600"},{value:"ADMIN",label:"ADMIN",icon:x.tMu,color:"text-blue-600"},{value:"SUPER_ADMIN",label:"SUPER_ADMIN",icon:x.bfl,color:"text-purple-600"}];function h(){let{role:e,viewMode:s,refreshAuth:t,setViewMode:h}=(0,c.a)(),p=(0,n.useRouter)(),[b,f]=(0,r.useState)([]),[j,w]=(0,r.useState)(!1),[g,N]=(0,r.useState)(""),[v,y]=(0,r.useState)(null),[k,_]=(0,r.useState)(null),[C,S]=(0,r.useState)(!1),[D,I]=(0,r.useState)(null),[R,E]=(0,r.useState)(null),U=async()=>{w(!0);try{let e=await d.hi.get("/admin/agency/users",{params:{q:g||void 0,limit:100}});f(e.users||[])}catch(e){console.error("Error loading users:",e),f([])}finally{w(!1)}};if((0,r.useEffect)(()=>{U()},[g]),"SUPER_ADMIN"!==e||"agency"!==s)return(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-yellow-50/80 border border-yellow-200 rounded-2xl p-4",children:(0,a.jsx)("p",{className:"text-yellow-800",children:"This page is only available to Super Admins in Agency View."})})});let A=e=>{y(e),_(u.find(s=>s.value===e.role)||u[0])},F=async()=>{if(v&&k){S(!0);try{await d.hi.put("/admin/agency/users/".concat(v.user_id),{role:k.value}),await U(),y(null),_(null)}catch(e){console.error("Error updating user role:",e),m.Am.error("Failed to update user role. Please try again.")}finally{S(!1)}}},L=e=>{let s=u.find(s=>s.value===e);if(!s)return(0,a.jsx)(x.fzv,{className:"w-4 h-4 text-ink-600"});let t=s.icon;return(0,a.jsx)(t,{className:"w-4 h-4 ".concat(s.color)})},M=e=>{switch(e){case"SUPER_ADMIN":return"bg-purple-100 text-purple-700";case"ADMIN":return"bg-blue-100 text-blue-700";default:return"bg-surface-50 text-ink-700"}},T=async e=>{I(e.user_id);try{let s=await d.hi.post("/admin/impersonate",{targetUserId:e.user_id});localStorage.setItem("impersonation_session_id",s.session_id),await t(),e.customer_id?h("subaccount",e.customer_id):h("subaccount"),p.push("/dashboard")}catch(e){console.error("Error starting impersonation from agency table:",e),m.Am.error("Failed to login as this user. Please try again.")}finally{I(null)}},P=async e=>{try{await navigator.clipboard.writeText(e),E(e),setTimeout(()=>E(null),2e3)}catch(e){console.error("Failed to copy customer ID:",e)}};return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,a.jsxs)("h1",{className:"text-xl sm:text-2xl font-bold text-ink-900 flex items-center gap-2",children:[(0,a.jsx)(x.WY8,{className:"w-5 h-5 sm:w-6 sm:h-6"}),"User Management"]}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-ink-600 mt-1",children:"Manage users, roles, and permissions across all accounts"})]}),(0,a.jsx)("div",{className:"mb-4 sm:mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.jRj,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-ink-400 w-4 h-4 sm:w-5 sm:h-5 pointer-events-none"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by name or email...",className:"w-full pl-9 sm:pl-10 pr-4 py-2.5 sm:py-2 text-base sm:text-sm border border-white/60 rounded-2xl bg-white/90 focus:ring-2 focus:ring-brand-500 focus:border-brand-500 shadow-soft outline-none transition-colors",value:g,onChange:e=>N(e.target.value)})]})}),(0,a.jsx)("div",{className:"md:hidden space-y-3",children:j?(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-8 text-center text-ink-500",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-brand-600"}),(0,a.jsx)("p",{className:"mt-2",children:"Loading users..."})]}):0===b.length?(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-8 text-center text-ink-500",children:[(0,a.jsx)(x.WY8,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No users found"})]}):b.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-4 space-y-3 transition-shadow hover:shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-ink-900 truncate",children:e.name||"Unknown"}),(0,a.jsx)("div",{className:"text-sm text-ink-500 truncate mt-0.5",children:e.email})]}),(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium flex-shrink-0 ml-2 ".concat(M(e.role)),children:[L(e.role),(0,a.jsx)("span",{className:"truncate max-w-[80px] sm:max-w-none",children:e.role})]})]}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/60 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-ink-500",children:"Customer ID:"}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0 flex-1 justify-end ml-2",children:[(0,a.jsx)("span",{className:"text-ink-900 font-mono truncate max-w-[140px]",title:e.customer_id,children:e.customer_id}),(0,a.jsx)("button",{onClick:()=>P(e.customer_id),className:"flex-shrink-0 p-1.5 text-ink-500 hover:text-ink-700 hover:bg-white/80 rounded-2xl transition-colors touch-target",title:R===e.customer_id?"Copied!":"Copy Customer ID","aria-label":"Copy Customer ID",children:R===e.customer_id?(0,a.jsx)(x.UgA,{className:"w-3.5 h-3.5 text-emerald-600"}):(0,a.jsx)(x.C3L,{className:"w-3.5 h-3.5"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-ink-500",children:"Created:"}),(0,a.jsx)("span",{className:"text-ink-900",children:new Date(e.created_at).toLocaleDateString()})]})]}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/60 flex flex-col gap-2",children:[(0,a.jsxs)("button",{onClick:()=>A(e),className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-brand-600 hover:text-brand-700 hover:bg-brand-50/60 rounded-2xl transition-colors touch-target",children:[(0,a.jsx)(x.IYd,{className:"w-4 h-4"}),"Edit Role"]}),(0,a.jsxs)("button",{onClick:()=>T(e),disabled:D===e.user_id,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-brand-600 hover:text-brand-700 hover:bg-brand-50/60 rounded-2xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed touch-target",children:[(0,a.jsx)(x._fJ,{className:"w-4 h-4"}),D===e.user_id?"Logging in...":"Log in as"]})]})]},e.user_id))}),(0,a.jsx)("div",{className:"hidden md:block bg-white rounded-2xl shadow-soft border border-white/60 overflow-hidden",children:j?(0,a.jsxs)("div",{className:"p-8 text-center text-ink-500",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-brand-600"}),(0,a.jsx)("p",{className:"mt-2",children:"Loading users..."})]}):0===b.length?(0,a.jsxs)("div",{className:"p-8 text-center text-ink-500",children:[(0,a.jsx)(x.WY8,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No users found"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-white/60",children:[(0,a.jsx)("thead",{className:"bg-white/80",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Customer ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Created"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-ink-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-white/60",children:b.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-white/80 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-ink-900",children:e.name||"Unknown"}),(0,a.jsx)("div",{className:"text-sm text-ink-500",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"text-sm text-ink-900 font-mono",children:e.customer_id}),(0,a.jsx)("button",{onClick:()=>P(e.customer_id),className:"p-1.5 text-ink-500 hover:text-ink-700 hover:bg-white/80 rounded-2xl transition-colors touch-target",title:R===e.customer_id?"Copied!":"Copy Customer ID","aria-label":"Copy Customer ID",children:R===e.customer_id?(0,a.jsx)(x.UgA,{className:"w-4 h-4 text-emerald-600"}):(0,a.jsx)(x.C3L,{className:"w-4 h-4"})})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(M(e.role)),children:[L(e.role),e.role]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-ink-500",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-4",children:[(0,a.jsxs)("button",{onClick:()=>A(e),className:"text-brand-600 hover:text-brand-700 flex items-center gap-1 transition-colors",children:[(0,a.jsx)(x.IYd,{className:"w-4 h-4"}),"Edit Role"]}),(0,a.jsxs)("button",{onClick:()=>T(e),disabled:D===e.user_id,className:"text-brand-600 hover:text-brand-700 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[(0,a.jsx)(x._fJ,{className:"w-4 h-4"}),D===e.user_id?"Logging in...":"Log in as"]})]})})]},e.user_id))})]})})}),(0,a.jsx)(l.u,{appear:!0,show:null!==v,as:r.Fragment,children:(0,a.jsxs)(i.Vq,{as:"div",className:"relative z-50",onClose:()=>{y(null),_(null)},children:[(0,a.jsx)(l.u.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsx)(l.u.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,a.jsxs)(i.Vq.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-4 sm:p-6 shadow-soft border border-white/60 transition-all",children:[(0,a.jsx)(i.Vq.Title,{as:"h2",className:"text-lg sm:text-xl font-bold text-ink-900 mb-4",children:"Edit User Role"}),v&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-ink-600 mb-2",children:[(0,a.jsx)("strong",{children:"User:"})," ",v.name||v.email]}),(0,a.jsxs)("p",{className:"text-sm text-ink-600",children:[(0,a.jsx)("strong",{children:"Current Role:"})," ",v.role]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-ink-700 mb-2",children:"New Role"}),(0,a.jsx)(o.Ri,{value:k,onChange:_,children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(o.Ri.Button,{className:"relative w-full cursor-default rounded-2xl bg-white/90 py-2.5 sm:py-2 pl-3 pr-10 text-left text-base sm:text-sm border border-white/60 shadow-soft focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 transition-colors",children:[(0,a.jsx)("span",{className:"block truncate flex items-center gap-2",children:k&&(0,a.jsxs)(a.Fragment,{children:[(()=>{let e=k.icon;return(0,a.jsx)(e,{className:"w-4 h-4 ".concat(k.color)})})(),(0,a.jsx)("span",{children:k.label})]})}),(0,a.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:(0,a.jsx)(x.bTu,{className:"h-4 w-4 text-ink-400","aria-hidden":"true"})})]}),(0,a.jsx)(l.u,{as:r.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,a.jsx)(o.Ri.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-2xl bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm border border-white/60",children:u.map(e=>(0,a.jsx)(o.Ri.Option,{className:e=>{let{active:s}=e;return"relative cursor-default select-none py-2 pl-3 pr-9 ".concat(s?"bg-brand-50 text-brand-900":"text-ink-900")},value:e,children:s=>{let{selected:t}=s;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"block truncate flex items-center gap-2 ".concat(t?"font-medium":"font-normal"),children:[(()=>{let s=e.icon;return(0,a.jsx)(s,{className:"w-4 h-4 ".concat(e.color)})})(),(0,a.jsx)("span",{children:e.label})]}),t?(0,a.jsx)("span",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-brand-600",children:(0,a.jsx)(x.UgA,{className:"h-4 w-4","aria-hidden":"true"})}):null]})}},e.value))})})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-2",children:[(0,a.jsx)("button",{onClick:F,disabled:C||!k||k.value===v.role,className:"flex-1 bg-brand-600 text-white px-4 py-2.5 sm:py-2 rounded-2xl hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-soft touch-target font-medium focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2",children:C?"Saving...":"Save"}),(0,a.jsx)("button",{onClick:()=>{y(null),_(null)},className:"flex-1 bg-white border border-white/60 text-ink-700 px-4 py-2.5 sm:py-2 rounded-2xl hover:bg-white/90 transition-colors shadow-soft touch-target font-medium focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2",children:"Cancel"})]})]})]})})})})]})})]})}}},function(e){e.O(0,[9134,2537,9190,8463,440,5755,9377,3783,7559,699,3951,6254,7115,2364,1744],function(){return e(e.s=7288)}),_N_E=e.O()}]);