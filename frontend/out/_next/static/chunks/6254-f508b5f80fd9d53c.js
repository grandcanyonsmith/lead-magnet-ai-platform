(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6254],{23677:function(){},38409:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return c}});var o=r(37821),n=r(58078),s=r(69439),a=r(63951);let i=(0,n.createContext)(void 0);function l(e){let{children:t,authService:r=s.O}=e,[l,c]=(0,n.useState)(null),[u,g]=(0,n.useState)(null),[m,d]=(0,n.useState)(null),[S,h]=(0,n.useState)(null),[_,I]=(0,n.useState)(null),[E,k]=(0,n.useState)(!1),[v,f]=(0,n.useState)(null),[w,T]=(0,n.useState)(null),[C,y]=(0,n.useState)(()=>localStorage.getItem("agency_view_mode")||null),[U,p]=(0,n.useState)(()=>localStorage.getItem("agency_selected_customer_id")),[P,K]=(0,n.useState)(!1),[O,A]=(0,n.useState)(!0),N=(0,n.useCallback)(async()=>{try{let e=await a.hi.get("/me");if(g(e.realUser),d(e.actingUser),h(e.role),I(e.customerId),k(e.isImpersonating),e.viewMode&&(y(e.viewMode),localStorage.setItem("agency_view_mode",e.viewMode)),e.selectedCustomerId&&(p(e.selectedCustomerId),localStorage.setItem("agency_selected_customer_id",e.selectedCustomerId)),c(e.actingUser),e.isImpersonating){let e=localStorage.getItem("impersonation_session_id");T(e)}else T(null),localStorage.removeItem("impersonation_session_id")}catch(t){console.error("Error refreshing auth:",t);let e=await r.getSession();if(e){let t=e.getIdToken().payload,r={user_id:t.sub||"",email:t.email||"",name:t.name,username:t["cognito:username"]||t.email||"",role:t["custom:role"]||"USER",customer_id:t["custom:customer_id"]||void 0};c(r),g(r),d(r),h(r.role||"USER"),I(r.customer_id||null),k(!1)}}},[r]),b=(0,n.useCallback)(async()=>{A(!0);try{let e=await r.isAuthenticated();if(K(e),e){let e=await r.getSession();f(e),await N()}else c(null),g(null),d(null),h(null),I(null),k(!1),f(null),T(null)}catch(e){console.error("Auth check error:",e),K(!1),c(null),g(null),d(null),h(null),I(null),k(!1),f(null),T(null)}finally{A(!1)}},[r,N]);(0,n.useEffect)(()=>{let e=setTimeout(()=>{b()},100);return()=>clearTimeout(e)},[b]);let Y=(0,n.useCallback)(async(e,t)=>{let o=await r.signIn(e,t);return o.success&&await b(),o},[r,b]),R=(0,n.useCallback)(async(e,t,o)=>r.signUp(e,t,o),[r]),x=(0,n.useCallback)(()=>{r.signOut(),c(null),f(null),K(!1),y(null),p(null),localStorage.removeItem("agency_view_mode"),localStorage.removeItem("agency_selected_customer_id")},[r]),X=(0,n.useCallback)((e,t)=>{(y(e),t)?(p(t),localStorage.setItem("agency_selected_customer_id",t)):(p(null),localStorage.removeItem("agency_selected_customer_id")),localStorage.setItem("agency_view_mode",e),N()},[N]);return(0,o.jsx)(i.Provider,{value:{user:l,realUser:u,actingUser:m,role:S,customerId:_,viewMode:C,selectedCustomerId:U,isImpersonating:E,session:v,sessionId:w,isAuthenticated:P,isLoading:O,signIn:Y,signUp:R,signOut:x,checkAuth:b,refreshAuth:N,setViewMode:X},children:t})}function c(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},69439:function(e,t,r){"use strict";r.d(t,{O:function(){return c}});var o=r(8463);class n{getAccessToken(){return localStorage.getItem(this.ACCESS_TOKEN_KEY)||this.getCognitoToken("accessToken")}getIdToken(){return localStorage.getItem(this.ID_TOKEN_KEY)||this.getCognitoToken("idToken")}getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)||this.getCognitoToken("refreshToken")}setTokens(e,t,r){localStorage.setItem(this.ACCESS_TOKEN_KEY,e),localStorage.setItem(this.ID_TOKEN_KEY,t),localStorage.setItem(this.REFRESH_TOKEN_KEY,r)}clearTokens(){localStorage.removeItem(this.ACCESS_TOKEN_KEY),localStorage.removeItem(this.ID_TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USERNAME_KEY),this.clearCognitoTokens()}hasTokens(){return!!(this.getAccessToken()||this.getIdToken())}setUsername(e){localStorage.setItem(this.USERNAME_KEY,e)}getUsername(){return localStorage.getItem(this.USERNAME_KEY)}getCognitoToken(e){let t="4lb3j8kqfvfgkvfeb4h4naani5";if(!t)return null;let r=localStorage.getItem("CognitoIdentityServiceProvider.".concat(t,".LastAuthUser"));if(!r)return null;let o="CognitoIdentityServiceProvider.".concat(t,".").concat(r,".").concat(e);return localStorage.getItem(o)}clearCognitoTokens(){let e="4lb3j8kqfvfgkvfeb4h4naani5";if(!e)return;let t=localStorage.getItem("CognitoIdentityServiceProvider.".concat(e,".LastAuthUser"));t&&(localStorage.removeItem("CognitoIdentityServiceProvider.".concat(e,".LastAuthUser")),localStorage.removeItem("CognitoIdentityServiceProvider.".concat(e,".").concat(t,".idToken")),localStorage.removeItem("CognitoIdentityServiceProvider.".concat(e,".").concat(t,".accessToken")),localStorage.removeItem("CognitoIdentityServiceProvider.".concat(e,".").concat(t,".refreshToken")))}constructor(){this.ACCESS_TOKEN_KEY="access_token",this.ID_TOKEN_KEY="id_token",this.REFRESH_TOKEN_KEY="refresh_token",this.USERNAME_KEY="cognito_username"}}let s=null,a=null,i=()=>{if(!s){let e="us-east-1_asu0YOrBD".trim(),t="4lb3j8kqfvfgkvfeb4h4naani5".trim();if(!e||!t){let r="Cognito configuration missing. UserPoolId: ".concat(e?"set":"missing",", ClientId: ").concat(t?"set":"missing");throw console.error(r),console.error("Environment variables:",{NEXT_PUBLIC_COGNITO_USER_POOL_ID:"us-east-1_asu0YOrBD",NEXT_PUBLIC_COGNITO_CLIENT_ID:"4lb3j8kqfvfgkvfeb4h4naani5"}),Error(r)}if(!/^[\w-]+_[a-zA-Z0-9]+$/.test(e)){let t='Invalid UserPoolId format: "'.concat(e,'". Expected format: region_poolId (e.g., us-east-1_XXXXXXXXX)');throw console.error(t),Error(t)}a=t,s=new o.AM({UserPoolId:e,ClientId:t})}return s};class l{async signIn(e,t){return new Promise(r=>{try{let n=i(),s=new o.sD({Username:e,Password:t});new o.ws({Username:e,Pool:n}).authenticateUser(s,{onSuccess:t=>{let o=t.getAccessToken().getJwtToken(),n=t.getIdToken().getJwtToken(),s=t.getRefreshToken().getToken();this.tokenStorage.setTokens(o,n,s),this.tokenStorage.setUsername(e),r({success:!0,session:t})},onFailure:e=>{r({success:!1,error:e.message})}})}catch(e){r({success:!1,error:e instanceof Error?e.message:"An unexpected error occurred"})}})}async signUp(e,t,r){return new Promise(n=>{try{let s=i(),a=[new o.KC({Name:"email",Value:e}),new o.KC({Name:"name",Value:r})];s.signUp(e,t,a,[],(e,t)=>{if(e){console.error("Signup error:",e);let t=e.message||"Failed to sign up",r=e.code||e.name;"InvalidParameterException"===r?t="Invalid signup parameters. Please check your email and password requirements.":"UsernameExistsException"===r?t="An account with this email already exists. Please sign in instead.":"InvalidPasswordException"===r&&(t="Password does not meet requirements. Must be at least 8 characters with uppercase, lowercase, and numbers."),n({success:!1,error:t});return}n({success:!0})})}catch(e){console.error("Signup exception:",e),n({success:!1,error:e instanceof Error?e.message:"An unexpected error occurred during signup"})}})}signOut(){try{let e=i().getCurrentUser();e&&e.signOut()}catch(e){console.warn("Error signing out:",e)}this.tokenStorage.clearTokens()}getCurrentUser(){try{return i().getCurrentUser()}catch(e){return null}}async getSession(){return new Promise(e=>{try{let t=i(),r=t.getCurrentUser();if(!r){if(i(),!a){e(null);return}let n=localStorage.getItem("CognitoIdentityServiceProvider.".concat(a,".LastAuthUser"));if(n)r=new o.ws({Username:n,Pool:t});else{let n=this.tokenStorage.getUsername();if(n)r=new o.ws({Username:n,Pool:t});else{e(null);return}}}r.getSession((t,r)=>{if(t||!r){e(null);return}e(r)})}catch(t){console.error("Error in getSession:",t),e(null)}})}async isAuthenticated(){try{if(i(),!a)return!1;let e=localStorage.getItem("CognitoIdentityServiceProvider.".concat(a,".LastAuthUser"));if(!e)return!1;let t=localStorage.getItem("CognitoIdentityServiceProvider.".concat(a,".").concat(e,".idToken")),r=localStorage.getItem("CognitoIdentityServiceProvider.".concat(a,".").concat(e,".accessToken"));if(!t||!r)return!1;try{let e=await this.getSession();if(!e)return console.warn("No session found, clearing authentication"),this.signOut(),!1;if(e.isValid()){let t=e.getIdToken().getExpiration(),r=Math.floor(Date.now()/1e3);if(t>r)return!0;return console.warn("Token expired, clearing authentication"),this.signOut(),!1}return console.warn("Session invalid, clearing authentication"),this.signOut(),!1}catch(t){let e=t instanceof Error?t.message:"Unknown error";return console.warn("Session check failed, token may be expired:",e),this.signOut(),!1}}catch(e){return console.error("Error checking authentication:",e),!1}}getTokenStorage(){return this.tokenStorage}constructor(e){this.tokenStorage=e||new n}}let c=new l}}]);