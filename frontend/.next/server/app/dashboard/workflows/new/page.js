(()=>{var e={};e.id=873,e.ids=[873],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},47244:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>p,tree:()=>d}),r(41382),r(20094),r(75966),r(12874);var s=r(27105),a=r(15265),l=r(90157),o=r.n(l),n=r(44665),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);r.d(t,i);let d=["",{children:["dashboard",{children:["workflows",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,41382)),"/Users/canyonsmith/lead-magnent-ai/frontend/src/app/dashboard/workflows/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,20094)),"/Users/canyonsmith/lead-magnent-ai/frontend/src/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,75966)),"/Users/canyonsmith/lead-magnent-ai/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,12874,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/canyonsmith/lead-magnent-ai/frontend/src/app/dashboard/workflows/new/page.tsx"],m="/dashboard/workflows/new/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/workflows/new/page",pathname:"/dashboard/workflows/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},18147:(e,t,r)=>{Promise.resolve().then(r.bind(r,61192))},59507:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var s=r(19899),a=r(55562),l=r(65684),o=r(95655),n=r(7038),i=r(71383),d=r(32183),c=r(83100);function m({step:e,index:t,totalSteps:r,allSteps:m=[],onChange:u,onDelete:p,onMoveUp:h,onMoveDown:x,workflowId:g}){let{localStep:b,webhookHeaders:f,handleChange:w,handleWebhookHeadersChange:y}=(0,d.x)({step:e,index:t,onChange:u}),{computerUseConfig:_,isToolSelected:v,handleToolToggle:j,handleComputerUseConfigChange:N}=(0,c.t)({step:b,onChange:w});return(0,s.jsxs)("div",{className:"border border-gray-300 rounded-lg p-6 bg-white shadow-sm",onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),e.stopPropagation())},children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex items-center gap-1 text-gray-400",children:s.jsx("span",{className:"text-xs",children:"⋮⋮"})}),(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Step ",t+1]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",onClick:()=>h(t),disabled:0===t,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step up",children:s.jsx(a.rH8,{className:"w-5 h-5"})}),s.jsx("button",{type:"button",onClick:()=>x(t),disabled:t===r-1,className:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300 disabled:cursor-not-allowed touch-target","aria-label":"Move step down",children:s.jsx(a.bTu,{className:"w-5 h-5"})}),s.jsx("button",{type:"button",onClick:()=>p(t),className:"p-2 text-red-600 hover:text-red-700 touch-target","aria-label":"Delete step",children:s.jsx(a.Ybf,{className:"w-5 h-5"})})]})]}),s.jsx(i.E,{workflowId:g,step:b,stepIndex:t,onAccept:e=>{u(t,e)}}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx(l.b,{step:b,onChange:w}),("ai_generation"===b.step_type||!b.step_type)&&s.jsx(o.b,{step:b,isToolSelected:v,onToolToggle:j,onToolChoiceChange:e=>w("tool_choice",e),onComputerUseConfigChange:N,computerUseConfig:_}),(()=>{let e="webhook"===b.step_type;return console.log("[WorkflowStepEditor] Rendering step",t,"step_type:",b.step_type,"isWebhook:",e),e&&s.jsx(n.E,{step:b,webhookHeaders:f,allSteps:m,currentStepIndex:t,onChange:w,onWebhookHeadersChange:y})})(),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dependencies (optional)"}),s.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Select which steps must complete before this step runs. Leave empty to auto-detect from step order."}),s.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3",children:m.length>0?m.map((e,r)=>{if(r===t)return null;let a=(b.depends_on||[]).includes(r);return(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:a,onChange:e=>{let t=b.depends_on||[];w("depends_on",e.target.checked?[...t,r]:t.filter(e=>e!==r))},className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,s.jsxs)("span",{className:"text-sm text-gray-900",children:["Step ",r+1,": ",e.step_name]})]},r)}):s.jsx("p",{className:"text-sm text-gray-500",children:"No other steps available"})}),b.depends_on&&b.depends_on.length>0&&(0,s.jsxs)("p",{className:"mt-2 text-xs text-gray-600",children:["Depends on: ",b.depends_on.map(e=>`Step ${e+1}`).join(", ")]})]})]})]})}},61192:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(19899),a=r(5507),l=r(76153),o=r(55562),n=r(59507);function i({formData:e,onChange:t}){return(0,s.jsxs)("div",{className:"space-y-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Lead Magnet Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Lead Magnet Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",value:e.workflow_name,onChange:e=>t("workflow_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Course Idea Validator",maxLength:200,required:!0,"data-tour":"workflow-name"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:e.workflow_description,onChange:e=>t("workflow_description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Describe what this lead magnet does...",rows:3,maxLength:1e3,"data-tour":"workflow-description"})]})]})}function d({templateData:e,onChange:t}){let[r,l]=(0,a.useState)(!1),n=(0,a.useMemo)(()=>{if(!e.html_content.trim())return"";let t=e.html_content,r={TITLE:"Sample Lead Magnet Title",CONTENT:"This is sample content that will be replaced with your actual lead magnet content when the template is used.",AUTHOR_NAME:"John Doe",COMPANY_NAME:"Your Company",DATE:new Date().toLocaleDateString(),EMAIL:"user@example.com",PHONE:"+1 (555) 123-4567",CURRENT_YEAR:new Date().getFullYear().toString()};return Object.keys(r).forEach(e=>{let s=RegExp(`\\{\\{${e}\\}\\}`,"g");t=t.replace(s,r[e])}),t=t.replace(/\{\{([A-Z_]+)\}\}/g,"[$1]")},[e.html_content]);return(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Template Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Template Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",value:e.template_name,onChange:e=>t("template_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Email Template",maxLength:200,required:!0})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:e.template_description,onChange:e=>t("template_description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Describe what this template is used for...",rows:3,maxLength:1e3})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["HTML Content ",s.jsx("span",{className:"text-red-500",children:"*"})]}),e.html_content.trim()&&(0,s.jsxs)("div",{className:"mb-4 border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[s.jsx(o.rDJ,{className:"w-4 h-4 mr-2"}),"HTML Preview"]}),s.jsx("button",{type:"button",onClick:()=>l(!r),className:"text-sm text-gray-600 hover:text-gray-900",children:r?"Hide Preview":"Show Preview"})]}),r&&s.jsx("div",{className:"bg-white border-t border-gray-200",style:{height:"600px"},children:s.jsx("iframe",{srcDoc:n,className:"w-full h-full border-0",title:"HTML Preview",sandbox:"allow-same-origin allow-scripts"},`preview-${e.html_content.length}-${e.html_content.slice(0,50)}`)})]}),s.jsx("textarea",{value:e.html_content,onChange:e=>{t("html_content",e.target.value),e.target.value.trim()&&!r&&l(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono text-sm",placeholder:"<!DOCTYPE html>...",rows:20,required:!0}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Use ",s.jsx("code",{className:"px-1 py-0.5 bg-gray-100 rounded",children:"{{PLACEHOLDER_NAME}}"})," syntax for dynamic content."]}),e.placeholder_tags.length>0&&(0,s.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Detected placeholders:"}),e.placeholder_tags.map(e=>s.jsx("span",{className:"px-2 py-1 bg-primary-50 text-primary-700 rounded text-xs font-mono",children:`{{${e}}}`},e))]})]})]})}function c({formFieldsData:e,onChange:t,onFieldChange:r}){let[l,n]=(0,a.useState)(!1);return 0===e.form_fields_schema.fields.length?null:(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Lead Capture Form"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Form Name ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",value:e.form_name,onChange:e=>{t("form_name",e.target.value),e.target.value.trim()&&!l&&n(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Lead Capture Form",maxLength:200,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Public Slug ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"text",value:e.public_slug,onChange:e=>t("public_slug",e.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"")),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono",placeholder:"lead-capture-form",pattern:"[a-z0-9\\-]+",required:!0}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["URL-friendly identifier (lowercase, hyphens only). Forms will be accessible at /v1/forms/",e.public_slug||"[slug]"]})]}),e.form_fields_schema.fields.length>0&&(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-gray-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[s.jsx(o.rDJ,{className:"w-4 h-4 mr-2"}),"Form Preview"]}),s.jsx("button",{type:"button",onClick:()=>n(!l),className:"text-sm text-gray-600 hover:text-gray-900",children:l?"Hide Preview":"Show Preview"})]}),l&&(0,s.jsxs)("div",{className:"bg-white p-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:e.form_name||"Form Preview"}),(0,s.jsxs)("div",{className:"space-y-4",children:[e.form_fields_schema.fields.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e.label||`Field ${t+1}`,e.required&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),"textarea"===e.field_type?s.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:e.placeholder||"",rows:4,disabled:!0}):"select"===e.field_type&&e.options?(0,s.jsxs)("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:!0,children:[(0,s.jsxs)("option",{value:"",children:["Select ",e.label]}),e.options.map((e,t)=>s.jsx("option",{value:e,children:e},t))]}):s.jsx("input",{type:"email"===e.field_type?"email":"tel"===e.field_type?"tel":"number"===e.field_type?"number":"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:e.placeholder||"",disabled:!0})]},e.field_id||t)),s.jsx("button",{type:"button",className:"w-full px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:!0,children:"Submit"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Form Fields (",e.form_fields_schema.fields.length,")"]}),s.jsx("div",{className:"space-y-4",children:e.form_fields_schema.fields.map((e,t)=>(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Label"}),s.jsx("input",{type:"text",value:e.label||"",onChange:e=>r(t,"label",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Field Label"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Type"}),(0,s.jsxs)("select",{value:e.field_type||"text",onChange:e=>r(t,"field_type",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[s.jsx("option",{value:"text",children:"Text"}),s.jsx("option",{value:"email",children:"Email"}),s.jsx("option",{value:"tel",children:"Phone"}),s.jsx("option",{value:"textarea",children:"Textarea"}),s.jsx("option",{value:"select",children:"Select"}),s.jsx("option",{value:"number",children:"Number"})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Placeholder"}),s.jsx("input",{type:"text",value:e.placeholder||"",onChange:e=>r(t,"placeholder",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Placeholder text"})]}),s.jsx("div",{className:"flex items-center",children:(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:e.required||!1,onChange:e=>r(t,"required",e.target.checked),className:"mr-2"}),s.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Required"})]})})]}),"select"===e.field_type&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Options (comma-separated)"}),s.jsx("input",{type:"text",value:e.options?.join(", ")||"",onChange:e=>r(t,"options",e.target.value.split(",").map(e=>e.trim()).filter(Boolean)),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Option 1, Option 2, Option 3"})]})]},e.field_id||t))})]})]})}function m({formData:e,onChange:t}){return(0,s.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 border-b pb-2",children:"Delivery Configuration"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Configure how completed lead magnets are delivered to leads. Choose webhook or SMS delivery."}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Method"}),(0,s.jsxs)("select",{value:e.delivery_method,onChange:e=>t("delivery_method",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"none",children:"No Delivery (Manual)"}),s.jsx("option",{value:"webhook",children:"Webhook"}),s.jsx("option",{value:"sms",children:"SMS (Twilio)"})]}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Select how you want to deliver the completed lead magnet to the lead"})]}),"webhook"===e.delivery_method&&(0,s.jsxs)("div",{className:"space-y-4 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Webhook Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Webhook URL ",s.jsx("span",{className:"text-red-500",children:"*"})]}),s.jsx("input",{type:"url",value:e.delivery_webhook_url,onChange:e=>t("delivery_webhook_url",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://api.example.com/webhook",required:"webhook"===e.delivery_method}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"The webhook will receive a POST request with job details, submission data, and output URL"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Headers (Optional)"}),s.jsx("textarea",{value:JSON.stringify(e.delivery_webhook_headers,null,2),onChange:e=>{try{let r=JSON.parse(e.target.value);t("delivery_webhook_headers",r)}catch{}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 font-mono text-sm",placeholder:'{\\n  "Authorization": "Bearer token",\\n  "X-Custom-Header": "value"\\n}',rows:4}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"JSON object with custom headers to include in webhook requests"})]})]}),"sms"===e.delivery_method&&(0,s.jsxs)("div",{className:"space-y-4 bg-green-50 border border-green-200 rounded-lg p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"SMS Configuration"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center mb-2",children:[s.jsx("input",{type:"checkbox",checked:e.delivery_sms_ai_generated,onChange:e=>t("delivery_sms_ai_generated",e.target.checked),className:"mr-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Use AI-Generated SMS Message"})]}),s.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"AI will generate a personalized SMS message based on the lead magnet content"})]}),e.delivery_sms_ai_generated?(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI SMS Instructions (Optional)"}),s.jsx("textarea",{value:e.delivery_sms_ai_instructions,onChange:e=>t("delivery_sms_ai_instructions",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Example: Keep it friendly and under 160 characters. Include the lead's name and make it personal.",rows:3}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional instructions for AI SMS generation. If empty, defaults to friendly message with URL."})]}):(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"SMS Message Template"}),s.jsx("textarea",{value:e.delivery_sms_message,onChange:e=>t("delivery_sms_message",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Hi {name}! Your personalized report is ready: {output_url}",rows:3,maxLength:320}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Use placeholders: ","{name}",", ","{output_url}",", ","{job_id}",". Max 160 characters per SMS."]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3",children:(0,s.jsxs)("p",{className:"text-xs text-blue-800",children:[s.jsx("strong",{children:"Note:"})," Twilio credentials must be configured in AWS Secrets Manager (us-east-1) for SMS delivery to work."]})})]})]})}var u=r(12330);let p={workflow_name:"",workflow_description:"",template_id:"",template_version:0,delivery_method:"none",delivery_webhook_url:"",delivery_webhook_headers:{},delivery_sms_enabled:!1,delivery_sms_message:"",delivery_sms_ai_generated:!1,delivery_sms_ai_instructions:""},h={template_name:"",template_description:"",html_content:"",placeholder_tags:[]},x={form_name:"",public_slug:"",form_fields_schema:{fields:[]}},g=[{step_name:"Deep Research",step_description:"Generate comprehensive research report",model:"gpt-5",instructions:"",step_order:0,tools:["web_search_preview"],tool_choice:"auto"},{step_name:"HTML Rewrite",step_description:"Rewrite content into styled HTML matching template",model:"gpt-5",instructions:"Rewrite the research content into styled HTML matching the provided template. Ensure the output is complete, valid HTML that matches the template's design and structure.",step_order:1,tools:[],tool_choice:"none"}];function b(){var e,t,r;let b=(0,l.useRouter)(),[f,w]=(0,a.useState)("prompt"),[y,_]=(0,a.useState)(""),[v,j]=(0,a.useState)(null),[N,k]=(0,a.useState)(null),[S,C]=(0,a.useState)(null),D=function(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[n,i]=(0,a.useState)(null);return{generateWorkflow:(0,a.useCallback)(async(e,r="gpt-5")=>{if(!e.trim())return o("Please describe what you want to build a lead magnet for"),null;console.log("[Workflow Generation] Starting AI generation...",{prompt:e.trim(),timestamp:new Date().toISOString()}),t(!0),o(null),s("Creating your lead magnet..."),i(null);try{let t=Date.now(),a=await u.hi.generateWorkflowWithAI({description:e.trim(),model:r,webhook_url:void 0});if(a.job_id){let e=a.job_id;return console.log("[Workflow Generation] Job created",{jobId:e,status:a.status}),s("Creating your lead magnet... This may take a minute."),{job_id:e,status:"pending"}}{if(!a.result)throw Error("No result in response");let e=Date.now()-t;return console.log("[Workflow Generation] Success!",{duration:`${e}ms`,workflow:a.result.workflow,template:a.result.template,form:a.result.form,timestamp:new Date().toISOString()}),s("Generation complete!"),i(a.result),setTimeout(()=>{s(null)},3e3),a.result}}catch(e){return console.error("[Workflow Generation] Failed:",e),o(e.response?.data?.message||e.message||"Failed to generate lead magnet with AI"),s(null),null}finally{t(!1)}},[]),isGenerating:e,generationStatus:r,error:l,result:n,reset:(0,a.useCallback)(()=>{t(!1),s(null),o(null),i(null)},[])}}(),M=function(){let[e,t]=(0,a.useState)(p),[r,s]=(0,a.useState)(h),[l,o]=(0,a.useState)(x),n=(0,a.useCallback)((e,r)=>{t(t=>({...t,[e]:r}))},[]),i=(0,a.useCallback)((e,t)=>{s(r=>({...r,[e]:t}))},[]),d=(0,a.useCallback)((e,t)=>{o(r=>({...r,[e]:t}))},[]);return{formData:e,templateData:r,formFieldsData:l,updateFormData:n,updateTemplateData:i,updateFormFieldsData:d,updateFormField:(0,a.useCallback)((e,t,r)=>{o(s=>{let a=[...s.form_fields_schema.fields];return a[e]={...a[e],[t]:r},{...s,form_fields_schema:{fields:a}}})},[]),populateFromAIGeneration:(0,a.useCallback)(e=>{e.workflow&&t(t=>({...t,workflow_name:e.workflow?.workflow_name||t.workflow_name,workflow_description:e.workflow?.workflow_description||t.workflow_description})),e.template&&s({template_name:e.template?.template_name||"",template_description:e.template?.template_description||"",html_content:e.template?.html_content||"",placeholder_tags:e.template?.placeholder_tags||[]}),e.form&&o({form_name:e.form.form_name||"",public_slug:e.form.public_slug||"",form_fields_schema:e.form.form_fields_schema||{fields:[]}})},[]),reset:(0,a.useCallback)(()=>{t(p),s(h),o(x)},[])}}(),T=function(e){let[t,r]=(0,a.useState)(g),s=(0,a.useCallback)((e,t)=>{r(r=>{let s=[...r];return s[e]={...t,step_order:e},s})},[]),l=(0,a.useCallback)(()=>{r(e=>[...e,{step_name:`Step ${e.length+1}`,step_description:"",step_type:"ai_generation",model:"gpt-5",instructions:"",step_order:e.length,tools:[],tool_choice:"auto"}])},[]),o=(0,a.useCallback)(e=>{r(t=>t.filter((t,r)=>r!==e).map((e,t)=>({...e,step_order:t})))},[]),n=(0,a.useCallback)(e=>{0!==e&&r(t=>{let r=[...t];return[r[e-1],r[e]]=[r[e],r[e-1]],r.map((e,t)=>({...e,step_order:t}))})},[]);return{steps:t,updateStep:s,addStep:l,deleteStep:o,moveStepUp:n,moveStepDown:(0,a.useCallback)(e=>{r(t=>{if(e===t.length-1)return t;let r=[...t];return[r[e],r[e+1]]=[r[e+1],r[e]],r.map((e,t)=>({...e,step_order:t}))})},[]),setStepsFromAIGeneration:(0,a.useCallback)(e=>{e&&Array.isArray(e)&&e.length>0&&r(e.map(e=>({step_name:e.step_name||"Step",step_description:e.step_description||"",model:e.model||"gpt-5",instructions:e.instructions||"",step_order:void 0!==e.step_order?e.step_order:0,tools:e.tools||[],tool_choice:e.tool_choice||"auto"})))},[]),updateFirstStepInstructions:(0,a.useCallback)(e=>{r(t=>{let r=[...t];return r.length>0&&(r[0]={...r[0],instructions:e}),r})},[]),setSteps:r}}(),q=(e=M.formData,t=T.steps,r=M.templateData,(0,a.useMemo)(()=>{let r=[];return e.workflow_name.trim()||r.push("Lead magnet name is required"),0===t.length&&r.push("At least one workflow step is required"),t.forEach((e,t)=>{e.step_name.trim()||r.push(`Step ${t+1} name is required`),e.instructions.trim()||r.push(`Step ${t+1} instructions are required`)}),{valid:0===r.length,errors:r}},[e,t,r])),L=function(){let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null);return{submitWorkflow:(0,a.useCallback)(async(e,r,a,l,o,n,i=!1)=>{s(null),i||t(!0);try{let t=e.template_id;a.html_content.trim()&&(o?(await u.hi.updateTemplate(o,{template_name:a.template_name||"Generated Template",template_description:a.template_description||"",html_content:a.html_content.trim(),placeholder_tags:a.placeholder_tags.length>0?a.placeholder_tags:void 0}),t=o):(t=(await u.hi.createTemplate({template_name:a.template_name||"Generated Template",template_description:a.template_description||"",html_content:a.html_content.trim(),placeholder_tags:a.placeholder_tags.length>0?a.placeholder_tags:void 0})).template_id,n(t)));let s=e.workflow_name.trim();if(!s)throw Error("Workflow name is required");if(0===r.length)throw Error("At least one workflow step is required");r.forEach((e,t)=>{if(!e.step_name?.trim())throw Error(`Step ${t+1} name is required`);if(!e.instructions?.trim())throw Error(`Step ${t+1} instructions are required`)});let i=await u.hi.createWorkflow({workflow_name:s,workflow_description:e.workflow_description?.trim()||"",steps:r.map((e,t)=>({...e,step_order:t,model:e.model,tools:e.tools,instructions:e.instructions.trim()})),template_id:t||void 0,template_version:e.template_version,delivery_method:e.delivery_method,delivery_webhook_url:"webhook"===e.delivery_method&&e.delivery_webhook_url?e.delivery_webhook_url:void 0,delivery_webhook_headers:"webhook"===e.delivery_method&&Object.keys(e.delivery_webhook_headers).length>0?e.delivery_webhook_headers:void 0,delivery_sms_enabled:"sms"===e.delivery_method,delivery_sms_message:"sms"===e.delivery_method&&e.delivery_sms_message?e.delivery_sms_message:void 0,delivery_sms_ai_generated:"sms"===e.delivery_method&&e.delivery_sms_ai_generated,delivery_sms_ai_instructions:"sms"===e.delivery_method&&e.delivery_sms_ai_generated&&e.delivery_sms_ai_instructions?e.delivery_sms_ai_instructions:void 0});return l.form_fields_schema.fields.length>0&&(i.form?.form_id?await u.hi.updateForm(i.form.form_id,{form_name:l.form_name||`Form for ${e.workflow_name}`,public_slug:l.public_slug||e.workflow_name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),form_fields_schema:l.form_fields_schema}):await u.hi.createForm({workflow_id:i.workflow_id,form_name:l.form_name||`Form for ${e.workflow_name}`,public_slug:l.public_slug||e.workflow_name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),form_fields_schema:l.form_fields_schema,rate_limit_enabled:!0,rate_limit_per_hour:10,captcha_enabled:!1})),i}catch(e){return console.error("Failed to create workflow:",e),s(e.response?.data?.message||e.message||"Failed to create workflow"),null}finally{i||t(!1)}},[]),isSubmitting:e,error:r}}();!function(e){let t=(0,l.useRouter)(),[r,s]=(0,a.useState)(null),[o,n]=(0,a.useState)(null),[i,d]=(0,a.useState)(null);(0,a.useRef)(null),(0,a.useCallback)(async()=>{if(e)try{try{let r=await fetch(`/api/webhooks/workflow-completion/${e}`);if(r.ok){let e=await r.json();if("completed"===e.status&&e.workflow_id){s("completed"),n(e.workflow_id),t.push(`/dashboard/workflows/${e.workflow_id}/edit`);return}if("failed"===e.status){s("failed"),d(e.error_message||"Workflow generation failed");return}}}catch(e){console.debug("[Workflow Generation Status] Webhook endpoint not available, using API")}let r=await u.hi.getWorkflowGenerationStatus(e);"completed"===r.status?(s("completed"),r.workflow_id?(n(r.workflow_id),t.push(`/dashboard/workflows/${r.workflow_id}/edit`)):r.result&&console.warn("[Workflow Generation Status] No workflow_id in response, checking result")):"failed"===r.status?(s("failed"),d(r.error_message||"Workflow generation failed")):s(r.status)}catch(e){console.error("[Workflow Generation Status] Error polling status",e),d(e.message||"Failed to check generation status")}},[e,t])}(S);let A=async()=>{if(!y.trim()){k("Please describe what you want to build a lead magnet for");return}k(null),w("creating");let e=await D.generateWorkflow(y.trim(),"gpt-5");e&&e.job_id?C(e.job_id):e&&D.generationStatus&&setTimeout(()=>{},5e3)},E=async e=>{if(e.preventDefault(),!q.valid){k(q.errors[0]);return}k(null),await L.submitWorkflow(M.formData,T.steps,M.templateData,M.formFieldsData,v,j,!1)&&b.push("/dashboard/workflows")};return"creating"===f?(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-ink-900",children:"Creating Your Lead Magnet"}),s.jsx("p",{className:"text-ink-600",children:"AI is generating your lead magnet configuration..."})]}),N&&s.jsx("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:N}),s.jsx("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6",children:s.jsx("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-8 text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center space-y-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-brand-600"}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-ink-900 mb-2",children:D.generationStatus||"Creating your lead magnet..."}),s.jsx("p",{className:"text-sm text-ink-600",children:"This may take a minute. We'll automatically take you to the edit page when it's ready."}),S&&(0,s.jsxs)("p",{className:"text-xs text-ink-500 mt-2 font-mono",children:["Job ID: ",S]})]})]})})})]}):"prompt"===f?(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-ink-900",children:"Create Lead Magnet"}),s.jsx("p",{className:"text-ink-600",children:"Describe what you want to build, and AI will generate everything for you"})]}),N&&s.jsx("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:N}),s.jsx("div",{className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6",children:(0,s.jsxs)("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-6 mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-ink-900 mb-2 flex items-center",children:[s.jsx(o.Wqx,{className:`w-5 h-5 mr-2 text-brand-600 ${D.isGenerating?"animate-pulse":""}`}),"What do you want to build?"]}),s.jsx("p",{className:"text-sm text-ink-600 mb-4",children:"Describe your lead magnet idea. AI will generate the name, description, research instructions, and template HTML for you."}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("textarea",{value:y,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border border-white/60 rounded-2xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-brand-500 disabled:bg-ink-100 disabled:cursor-not-allowed shadow-soft",placeholder:"e.g., A course idea validator that analyzes market demand, competition, target audience, and provides actionable recommendations for course creators...",rows:6,disabled:D.isGenerating}),D.generationStatus&&(0,s.jsxs)("div",{className:"bg-brand-50/80 border border-brand-200 rounded-2xl p-3 flex items-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-brand-600 mr-3"}),s.jsx("span",{className:"text-sm text-brand-800 font-medium",children:D.generationStatus})]}),s.jsx("button",{type:"button",onClick:A,disabled:D.isGenerating||!y.trim(),className:"flex items-center justify-center px-6 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft disabled:opacity-50 disabled:cursor-not-allowed w-full sm:w-auto",children:D.isGenerating?(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),s.jsx("span",{children:"Generating..."})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(o.Wqx,{className:"w-5 h-5 mr-2"}),s.jsx("span",{children:"Generate Lead Magnet"})]})})]})]})})]}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-ink-900",children:"Create Lead Magnet"}),s.jsx("p",{className:"text-ink-600",children:"Review and edit the generated configuration"})]}),N&&s.jsx("div",{className:"mb-6 bg-red-50/80 border border-red-200 text-red-700 px-4 py-3 rounded-2xl",children:N}),D.generationStatus&&s.jsx("div",{className:"mb-6 bg-emerald-50/80 border border-emerald-200 text-emerald-700 px-4 py-3 rounded-2xl",children:D.generationStatus}),(0,s.jsxs)("div",{className:"mb-6 bg-brand-50/80 border border-brand-200 rounded-2xl p-4",children:[s.jsx("h3",{className:"text-sm font-semibold text-brand-900 mb-2",children:"Processing Modes"}),s.jsx("p",{className:"text-sm text-brand-800 mb-2",children:"Choose how your lead magnet is generated:"}),(0,s.jsxs)("ul",{className:"text-sm text-brand-800 space-y-1 list-disc list-inside",children:[(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"Research + HTML:"})," AI generates personalized research, then converts it to styled HTML"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"Research Only:"})," AI generates research report (markdown format)"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"HTML Only:"})," AI generates styled HTML directly from form submission"]}),(0,s.jsxs)("li",{children:[s.jsx("strong",{children:"Text Only:"})," Simple text output from form submission"]})]})]}),(0,s.jsxs)("form",{onSubmit:E,className:"bg-white rounded-2xl shadow-soft border border-white/60 p-6 space-y-6","data-tour":"workflow-form",children:[s.jsx(i,{formData:M.formData,onChange:M.updateFormData}),(0,s.jsxs)("div",{className:"space-y-4 pt-6 border-t","data-tour":"workflow-steps",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h2",{className:"text-xl font-semibold text-ink-900",children:"Workflow Steps"}),(0,s.jsxs)("button",{type:"button",onClick:T.addStep,className:"flex items-center gap-2 px-4 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft touch-target",children:[s.jsx(o.OvN,{className:"w-4 h-4"}),"Add Step"]})]}),s.jsx("p",{className:"text-sm text-ink-600 mb-4",children:"Define the steps your workflow will execute. Each step receives context from all previous steps."}),s.jsx("div",{className:"space-y-4",children:T.steps.map((e,t)=>s.jsx(n.Z,{step:e,index:t,totalSteps:T.steps.length,allSteps:T.steps,onChange:T.updateStep,onDelete:T.deleteStep,onMoveUp:T.moveStepUp,onMoveDown:T.moveStepDown},t))})]}),(M.formData.template_id||M.templateData.html_content.trim())&&s.jsx(d,{templateData:M.templateData,onChange:M.updateTemplateData}),M.formFieldsData.form_fields_schema.fields.length>0&&s.jsx(c,{formFieldsData:M.formFieldsData,onChange:M.updateFormFieldsData,onFieldChange:M.updateFormField}),s.jsx(m,{formData:M.formData,onChange:M.updateFormData}),s.jsx("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:(0,s.jsxs)("button",{type:"submit",disabled:L.isSubmitting,className:"flex items-center px-6 py-2 bg-brand-600 text-white rounded-2xl hover:bg-brand-700 transition-colors shadow-soft disabled:opacity-50 disabled:cursor-not-allowed","data-tour":"create-workflow-button",children:[s.jsx(o.mW3,{className:"w-5 h-5 mr-2"}),L.isSubmitting?"Creating...":"Create Lead Magnet"]})})]})]})}},41382:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2772).createProxy)(String.raw`/Users/canyonsmith/lead-magnent-ai/frontend/src/app/dashboard/workflows/new/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[257,138,920,501,809],()=>r(47244));module.exports=s})();